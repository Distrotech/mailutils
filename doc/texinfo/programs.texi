@c This is part of the GNU Mailutils manual.
@c Copyright (C) 1999,2000,2001,2002,2003,2004,2005,2006,2007
@c Free Software Foundation, Inc.
@c See file mailutils.texi for copying conditions.
@comment *******************************************************************

@sc{gnu} Mailutils provides a set of programs for handling the e-mail.

@menu
* configuration::     Common Configuration File.
* authentication::    Authorization and Authentication Principles.

* frm and from::      List Headers from a Mailbox.
* mail::              Send and Receive Mail.
* messages::          Count the Number of Messages in a Mailbox.
* movemail::          Moves Mail from the User Maildrop to the Local File.
* readmsg::           Extract Messages from a Folder.

* sieve::             Mail Filtering Utility.
* guimb::             Mailbox Scanning and Processing Language.

* mail.local::        Deliver Mail to the Local Mailbox.
* mail.remote::       Pseudo-Sendmail Interface for Mail Delivery.

* mimeview::          Universal File Viewer.

* pop3d::             POP3 Daemon.
* imap4d::            IMAP4 Daemon.
* comsatd::           Comsat Daemon.

* mh::                The MH Message Handling System.

* mailutils-config::  Get the Information about the Mailutils Build.
@end menu

@node configuration
@section Mailutils Configuration File
@cindex Mailutils configuration file
@cindex mailutils.rc

There are some command line options that are used so often that it is
inconvenient to specify them in the command line each time you run
a Mailutils utility. The @dfn{configuration files} provide a way to
add default command line arguments without having to type them in
the command line. Upon startup, each Mailutils utility scans and
processes the contents of the three startup files, none of which
are required to exist:

@enumerate
@item the site-wide configuration file

@file{mailutils.rc}, found in your your system configuration directory
(usually @file{/etc} or @file{/usr/local/etc}).

@item the user-specific configuration file

Usually @file{~/.mailutils}, unless @file{~/.mailutils} is a directory,
in which case @file{~/.mailutils/mailutils} is used.

@item the programs-specific configuration file

Usually @file{~/.mu.@var{program}rc}, unless @file{~/.mailutils} is a
directory, in which case @file{~/.mailutils/@var{program}rc} is used
(where @var{program} means the program name).
@end enumerate

These files have simple line-oriented syntax. Comments begin with the
pound sign (@samp{#}) and extend through the end of the line
@footnote{If @samp{#} is not the first character on the line, it
should be separated from the previous word by any amount of whitespace.}.
Very long lines may be split across several lines by escaping final newline
with a backslash (@samp{\}) character.

In the non-program-specific configuration files, any configuration line
must start with a @dfn{tag}. In the program-specific configuration
file the tag must not be present, all options are for that specific
program.

A tag is either a name of a particular Mailutils utility or @dfn{option
group}, prefixed with colon (@samp{:}). The command line options common for
several Mailutils programs are divided into @dfn{option groups} or
@dfn{capabilities}, e.g. the options @option{--mail-spool} and
@option{--lock-flags} form group @samp{mailbox}. These groups are discussed
in detail below.

When processing the non-program-specific configuration files,
a Mailutils utility selects those lines whose tag is either the name
of that utility or the name of the option group supported by it.
In the program-specific configuration file, all lines are selected.
For each line found, its tag (if present) is stripped away, and the
rest of the line is split up into words. These words are regarded as
command line options and are inserted to the program arguments
@emph{before} any options from the command line. Thus the options
from @file{.mailutils} take precedence over those from @file{mailutils.rc},
and the options from the command line take precedence over those from
all three configuration files.

The word splitting occurs at whitespace characters and is similar to
that performed by the shell. If an option must contain embedded
whitespace, it should be enclosed in a pair of quotes (either double
or single quotes).

@menu
* common::             Options understood by most @sc{gnu} utilities.
* mailbox::            Specifies the mail spool location, and locking strategy.
* mailer::             Sets the mailer URL.
* address::            Specifies the default email address and domain.
* daemon::             Options common for daemon programs.
* auth::               Authentication-specific options.
* encryption::         Encryption options.
* logging::            Logging control options.
* sieve: sieve group.  Sieve specific options
* config sample::      A sample configuration file.
@end menu

@node common
@subsection Common

Each program understands the following informational options:

@table @option
@item -u
@itemx --usage
Display a short usage message and exit.
@item -h
@itemx --help
Display help message and exit.
@item -L
@itemx --license
Display @sc{gnu} General Public License and exit.
@item -v
@itemx --version
Display program version and exit.
@end table

@node mailbox
@subsection Mailbox
@cindex :mailbox

Option group @samp{mailbox} consists of options used to specify the
location of the mail spool, and the locking strategy.

@table @option
@item -m @var{path}
@itemx --mail-spool=@var{path}
Set path to the mailspool directory
@item --lock-flags=@var{flags}
Set the default mailbox lock flags (E=external, R=retry, T=time, P=pid).
@end table

@node mailer
@subsection Mailer
@cindex :mailer

This option group overrides the default mailer URL (@url{sendmail:}).

@table @option
@item -m @var{url}
@itemx --mailer @var{url}
@end table

@node address
@subsection Address
@cindex :address

Option group @samp{address} consists of options used to specify how to
qualify email addresses.

An unqualified address (one without an @var{@@}) is qualified by appending
@var{@@}@var{defaultdomain}. @var{defaultdomain} is the return of
@code{gethostname()}, or the result of @code{gethostbyname()} on the return
of @code{gethostname()} (if the DNS lookup is successful).

If the email address of the current user is needed, either the address set by
@option{--email-addr} is returned, or the current uid is looked up in the user
database, and qualified with the @var{defaultdomain}.

@table @option
@item -E @var{email}
@itemx --email-addr=@var{email}
Set the current user's email address, this it makes more sense to use
this in one of the per-user configuration files.
@item -D @var{domain}
@itemx --email-domain=@var{domain}
Set the default email domain, this might make sense to use in either
the global or one of the per-user configuration files.
@end table

@node daemon
@subsection Daemon
@cindex :daemon

@table @option
@item -d[@var{number}]
@itemx --daemon[=@var{number}]
Run in standalone mode. An optional @var{number} specifies the maximum number
of child processes the daemon is allowed to fork. When it is omitted,
it defaults to 20 processes.
@emph{Please note}, that there should be no whitespace between the
@option{-d} and its parameter.
@item -i
@itemx --inetd
Run in inetd mode.
@item -p @var{number}
@itemx --port @var{number}
Listen on given port @var{number}. This option is meaningful only in
standalone mode. It defaults to port 143.
@item -t @var{number}
@itemx --timeout @var{number}
Set idle timeout to given @var{number} of seconds. The daemon breaks the
connection if it receives no commands from the client within that number
of seconds.
@end table

@node auth
@subsection Auth
@cindex :auth

These options control the authorization and authentication module
lists. For a description of authentication concepts, refer to
@xref{authentication}.

@table @option
@item --authorization @var{modlist}

This option allows to set up a list of modules to be used for
authorization. @var{modlist} is a colon-separated list of
modules. Valid modules are:

@table @asis
@item system
User credentials are retrieved from the system user database
(@file{/etc/password}).
@item sql
User credentials are retrieved from the @acronym{sql} database. The set
of @option{--sql-} options (see below) is used to configure
access to the database.
@item virtdomain
User credentials are retrieved from a ``virtual domain'' user
database.
@end table

@item --authentication @var{modlist}

This option allows to set up a list of modules to be used for
authentication. @var{modlist} is a colon-separated list of
modules. Valid modules are:

@table @asis
@item generic
The generic authentication type. User password is hashed and compared
against the hash value returned in authorization stage.
@item system
The hashed value of the user password is retrieved from
@file{/etc/shadow} file on systems that support it.
@item sql
The hashed value of the user password is retrieved from the @acronym{sql}
database using query supplied by @option{--sql-getpass} option
(see below).
@item pam
The user is authenticated via pluggable authentication module
(@acronym{pam}). The @acronym{pam} service name to be used is
configured via @option{--pam-service} option (see below).
@end table

@item --pam-service @var{name}
When compiled with @acronym{pam} support, this option specifies the
name of @acronym{pam} service to be used when authenticating.
@end table

The following options exist in this group if the package was configured
with @option{--enable-sql} option. They take effect only if the
@samp{sql} module is used in authentication and/or authorization.

@table @option
@item --sql-interface @var{iface}
Specify @sc{sql} interface to use. @var{Iface} is either @samp{mysql}
or @samp{postgres}. This allows to select @sc{sql} subsystem on
runtime if @code{mailutils} was compiled with support for several
@sc{sql} drivers.

If this option is omitted, @code{mailutils} will use the first
available @sc{sql} driver. 

@item --sql-host @var{name}
Name or IP of MySQL server to connect to.

@item --sql-user @var{name}
@acronym{sql} user name

@item --sql-passwd @var{string}
@acronym{sql} connection password

@item --sql-db @var{string}
Name of the database to connect to.

@item --sql-port @var{number}
Port to use

@item --sql-getpwnam @var{query}
@acronym{sql} query to retrieve a passwd entry based on username

@item --sql-getpwuid @var{query}
@acronym{sql} query to retrieve a passwd entry based on user ID
 
@item --sql-getpass @var{query}
@acronym{sql} query to retrieve a password from the database
@end table

@node encryption
@subsection Encryption
@cindex :encryption

These options control TLS/SSL encryption in @command{imap4d}
and @command{pop3d} daemons.

@table @option
@item --ssl-cert @var{file}
This option specifies the file name of the server side SSL certificate
(accepts PEM format).
@item --ssl-key @var{file}
This option specifies the file name of the server side private SSL key
(accepts PEM format). The key must be protected with 0600 file permissions
(u=rw,g=,o=), otherwise @command{imap4d} or @command{pop3d} daemons will
refuse to support TLS/SSL encryption.
@item --ssl-cafile @var{file}
This option specifies a file containing the list of trusted CAs (PEM list)
in order to verify client's certificates. This option is not required.
@end table

@node logging
@subsection Logging
@cindex :logging

@table @option
@item --log-facility @var{facility}
Output logs to the specified @command{syslog} facility. The following
facility names are recognized: @samp{user}, @samp{daemon}, @samp{mail},
@samp{auth} and @samp{local0} through @samp{local7}. These names are
case-insensitive.
@end table

@node sieve group
@subsection Sieve Specific Options
@cindex :sieve

The following options comprise this group:

@table @option
@item -I @var{dir}
@itemx --includedir=@var{dir}
Append directory @var{dir} to the list of directories searched for
include files.

@item -L @var{dir}
@itemx --libdir=@var{dir}
Append directory @var{dir} to the list of directories searched for
library files.
@end table

@node config sample
@subsection A Sample Configuration File
@cindex mailutils.rc, an example

The following configuration file specifies that all Mailutils programs
should use @file{/var/spool/mail} as a local mailspool
directory. Programs performing authentication will use @acronym{pam}
service @samp{mailutils}. All programs, except @command{imap4d} will
issue log messages via @samp{mail} facility, @command{imap4d} will use
facility @samp{local1}.

@smallexample
@group
:mailbox --mail-spool /var/spool/mail
:auth --authentication pam --pam-service mailutils
:logging --log-facility mail
imap4d --daemon=20 --timeout=1800 --log-facility local1
@end group
@end smallexample 

@node authentication
@section Authorization and Authentication Principles
@cindex authorization
@cindex authentication

Some mail utilities provide access to their services only after
verifying that the user is actually the person he is claiming
to be. Such programs are, for example, @command{pop3d} and
@command{imap4d}. The process of the verification is broken
down into two stages: @dfn{authorization} and @dfn{authentication}.
In @dfn{authorization} stage the program retrieves the information
about a particular user. In @dfn{authentication} stage, this information
is compared against the user-supplied credentials. Only if both stages
succeed is the user allowed to use the service.

A set of @dfn{modules} is involved in performing each stage. For
example, the authorization stage can retrieve the user description
from various sources: system database, sql database, virtual domain
table, etc. Each module is responsible for retrieving the description
from a particular source of information. The modules are arranged in
a @dfn{module list}. The modules from the list are invoked in turn, until
either a one of them succeeds or the list is exhausted. In latter case
the authorization fails. Otherwise the data returned by the succeeded
module are used in authentication.

Similarly, authentication may be performed in several ways. The
authentication modules are also grouped in a list. Each module
is tried in turn until either a module succeeds, in which case the
authentication succeeds, or the end of the list is reached.

We represent the module lists as column-separated lists of module
names. For example, the authorization list

@smallexample
system:sql:virtdomains
@end smallexample

@noindent
means that first the system user database (@file{/etc/password}) is
searched for a description of a user in question. If the search fails,
the @acronym{sql} database is searched. Finally, if it also fails, the
search is performed in the virtual domain database.

@emph{Note}, that some authentication and/or authorization modules may
be disabled when configuring the package before compilation. The names
of the disabled modules are nevertheless available for use in runtime
configuration options, but they represent a ``fail-only'' functionality,
e.g. if the package was compiled without @acronym{sql} support then the
module @samp{sql} in the above example will always fail, thus passing
the execution on to the next module.

The modules available for use in authorization list are:

@table @asis
@item system
User credentials are retrieved from the system user database
(@file{/etc/password}).
@item sql
User credentials are retrieved from the @acronym{sql} database. The set
of @option{--sql-} options (@pxref{auth}) is used to configure
access to the database.
@item virtdomain
User credentials are retrieved from a ``virtual domain'' user
database.
@end table

The modules available for use in authentication list are:

@table @asis
@item generic
The generic authentication type. User password is hashed and compared
against the hash value returned in authorization stage.
@item system
The hashed value of the user password is retrieved from
@file{/etc/shadow} file on systems that support it.
@item sql
The hashed value of the user password is retrieved from the @acronym{sql}
database using query supplied by @option{--sql-getpass} option
(@pxref{auth}).
@item pam
The user is authenticated via pluggable authentication module
(@acronym{pam}). The @acronym{pam} service name to be used is
configured via @option{--pam-service} option (@pxref{auth})
@end table

Unless overridden by @option{--authentication} command line option,
the list of authentication modules is:

@smallexample
generic:system:pam:sql
@end smallexample

@noindent
Unless overridden by @option{--authorization} command line option,
the list of authorization modules is:

@smallexample
system:sql:virtdomains
@end smallexample

@page
@node frm and from
@section @command{frm} and @command{from} --- List Headers from a Mailbox

GNU mailutils provides two commands for listing messages in a mailbox.
These are @command{from} and @command{frm}.

@subheading @command{frm}
@pindex frm

The @command{frm} command outputs a header information of
the selected messages in a mailbox. By default, @command{frm} reads the
user's system mailbox and outputs the contents of @code{From} and
@code{Subject} headers for each message. If a folder is specified in
the command line, the program reads that folder rather than the default
mailbox.

The program uses following option groups: @xref{mailbox}.

The following command line options alter the behavior of the program:

@table @option
@item -f @var{string}
@itemx --field @var{string}
Display the header named by @var{string} instead of @code{From}
@code{Subject} pair.
@item -l
@itemx --to
Include the contents of @code{To} header to the output. The output field
order is then: @code{To} @code{From} @code{Subject}.
@item -n
@itemx --number
Prefix each line with corresponding message number.
@item -Q
@itemx --Quiet
Be very quiet. Nothing is output except error messages. This is useful
in shell scripts where only the return status of the program is
important.
@item -q
@itemx --query
Print a message only if there are unread messages in the mailbox.
@item -S
@itemx --summary
Print a summary line.
@item -s @var{attr}
@itemx --status @var{attr}
Only display headers from messages with the given status.
@var{Attr} may be one of the following: @samp{new}, @samp{read},
@samp{unread}. It is sufficient to specify only first letter of
an @var{attr}. Multiple @option{-s} options are allowed.
@item -t
@itemx --align
Tidy mode. In this mode @command{frm} tries to preserve the alignment of
the output fields. It also enables the use of BIDI algorithm for
displaying subject lines that contain text in right-to-left
orientation (such as Arabic or Hebrew).
@end table

@subheading @command{from}
@pindex from

The @command{from} utility displays sender and subject of each message
in a mailbox. By default, it reads the user's system mailbox. If the
program is given a single argument, it is interpreted as a user
name whose mailbox is to be read. Obviously, permissions are required
to access that user's mailbox, so such invocations may be used only
by superuser.

Option @option{-f} (@option{--file}) instructs the program to read
the given mailbox.

The full list of options, supported by @command{from} follows:

@table @option
@item -c
@itemx --count
Prints only a count of messages in the mailbox and exit.

@item -d
@itemx --debug
Prints additional debugging outut.

@item -s @var{string}
@itemx --sender=@var{string}
Prints only mail from addresses containing the supplied string.
FIXME: only @code{From:} header is examined.

@item -f @var{url}
@itemx --file=@var{url}
Examine mailbox from the given @var{url}.
@end table

@page
@node mail
@section @command{mail} --- Send and Receive Mail
@pindex mail

@command{Mail} is an enhanced version of standard @command{/bin/mail} program.
As well as its predecessor, it can be used either in sending mode or
in reading mode. @command{Mail} enters sending mode when one or more
email addresses were specified in this command line. In this mode the
program waits until user finishes composing the message, then attempts
to send it to the specified addresses and exits.
See @ref{Composing Mail}, for a detailed description of this behavior.

If the command line contained no email addresses, @command{mail} switches
to reading mode. In this mode it allows to read and manipulate the
contents of a mailbox. The URL of the mailbox to operate upon is
taken from the argument of @option{--file} command line option. If it
is not specified, the user's system mailbox is assumed. For more
detail, see @ref{Reading Mail}.

@menu
* Invoking Mail::            Command Line Options.
* Specifying Messages::      How to Specify Message Sets.
* Composing Mail::           Composing Mail.
* Reading Mail::             Reading Mail.
* Scripting::                Scripting.
* Mail Variables::           How to Alter the Behavior of @command{mail}.
* Mail Configuration Files:: Personal and System-wide Configuration Files.
@end menu

@node Invoking Mail
@subsection Invoking @command{mail}

General usage of @command{mail} program is:

@smallexample
      mail [@var{option}...] [@var{address}...]
@end smallexample
@noindent
If [@var{address}...] part is present, @command{mail} switches to
mail sending mode, otherwise it operates in mail reading mode.

The program uses following option groups: @xref{mailbox}.

@command{Mail} understands following command line options:

@table @option
@item -e
@itemx --exist
Return true if the mailbox contains some messages. Return false
otherwise.
This is useful for writing shell scripts.
@item -E @var{command}
@itemx --exec=@var{command}
Execute @var{command} before opening the mailbox. Any number of
@option{--exec} options can be given. The commands will be executed
after sourcing configuration files (@pxref{Mail Configuration Files}),
but before opening the mailbox. 
@item --exec
@item -f[@var{file}]
@itemx --file[=@var{file}]
Operate on mailbox @var{file}. If this option is not specified, the default
is user's system mailbox. If it is specified without argument, the
default is @file{$HOME/mbox}.
@emph{Please note}, that there should be no whitespace between the
short variant of the option (@option{-f}), and its parameter. Similarly,
when using long option (@option{--file}), its argument must be preceded by
equal sign.
@item -F
@itemx --byname
Save messages according to sender. Currently this option is not implemented.
@item -H
@itemx --headers
Print header summary to stdout and exit.
@item -i
@itemx --ignore
Ignore interrupts.
@item -m @var{path}
@itemx --mail-spool=@var{path}
Set path to the mailspool directory
@item -n
@itemx --norc
Do not read the system-wide mailrc file. @xref{Mail Configuration Files}.
@item -N
@itemx --nosum
Do not display initial header summary.
@item -p
@itemx --print
@itemx -r
@itemx --read
Print all mail to standard output. It is equivalent to issuing following
commands after starting @samp{mail -N}:
@smallexample
@group
print *
quit
@end group
@end smallexample
@item -q
@itemx --quit
Cause interrupts to terminate program.
@item -s @var{subj}
@itemx --subject=@var{subj}
Send a message with a Subject of @var{subj}. Valid only in sending mode.
@item -t
@itemx --to
Switch to sending mode.
@item -u @var{user}
@itemx --user=@var{user}
Operate on @var{user}'s mailbox. This is equivalent to:

@smallexample
mail -f/@var{spool_path}/@var{user}
@end smallexample

@noindent
with @var{spool_path} being the full path to your mailspool directory
@*(@file{/var/spool/mail} or @file{/var/mail} on most systems).
@item -?
@itemx --help
Display a help message.
@itemx --usage
Display a short usage summary.
@item -V
@itemx --version
Print program version and exit.
@end table

@node Specifying Messages
@subsection How to Specify Message Sets

Many mail commands such as print and delete can be given a @dfn{message list}
to operate upon. Wherever the message list is omitted, the command
operates on the current message.

The @dfn{message list} in its simplest form is one of:

@table @asis
@item .
Selects current message. It is equivalent to empty message list.
@item *
Selects all messages in the mailbox.
@item ^
Selects first non-deleted message.
@item $
Selects last non-deleted message.
@end table

In its complex form, the @dfn{message list} is a comma or whitespace-separated
list of @dfn{message specifiers}. A @dfn{message specifier} is one
of

@table @asis
@item Message Number
This specifier addresses the message with the given ordinal number
in the mailbox.
@item Message range
@dfn{Message range} is specified as two message numbers separated by
a dash. It selects all messages with the number lying within that range.
@item Attribute specifier
An @dfn{Attribute specifier} is a colon followed by a single
letter. The @dfn{Attribute specifier} addresses all messages in the
mailbox that have the given attribute. These are the valid attribute
specifiers:

@table @samp
@item :d
Selects all deleted messages.
@item :n
Selects all recent messages, i.e. the messages that have not been
neither read not seen so far.
@item :o
Selects all messages that have been seen.
@item :r
Selects all messages that have been read.
@item :u
Selects all messages that have @emph{not} been read.
@item :t
Selects all tagged messages.
@item :T
Selects all untagged messages.
@end table
@item Header match
The @dfn{header match} is a string in the form:

@smallexample
[@var{header}:]/@var{string}/
@end smallexample
@noindent

It selects all messages that contain header field @var{header}
matching given @var{regexp}. If the variable @code{regexp} is set,
the @var{string} is assumed to be a POSIX regexp. Otherwise, a
header is considered to match @var{string} if the latter constitutes
a substring of the former (comparison is case-insensitive).

If @var{header}: part is omitted, it is assumed to be @samp{Subject:}.
@item Message body match
The @dfn{message body match} is a string in the form:

@smallexample
:/@var{string}/
@end smallexample
@noindent

It selects all messages whose body matches the string. The matching
rules are the same as described under ``Header match''.
@end table

A @dfn{message specifier} can be followed by @dfn{message part
specifier}, enclosed in a pair of brackets. A @dfn{message part
specifier} controls which part of a message should be operated upon.
It is meaningful only for multipart messages. A @dfn{message part
specifier} is a comma or whitespace - separated list of part numbers
or ranges. Each part number can in turn be @dfn{message part specifier},
thus allowing for operating upon multiply-encoded messages.

The following are the examples of valid message lists:

@node Composing Mail
@subsection Composing Mail

You can compose the message by simply typing the contents of it, line
by line. But usually this is not enough, you would need to edit
your text, to quote some messages, etc. @command{Mail} provides these
capabilities through @dfn{compose escapes}. The @dfn{compose escapes}
are single-character commands, preceded by special @dfn{escape character},
which defaults to @samp{~}. The combination @code{escape character + command}
is recognized as a compose escape only if it occurs at the beginning of
a line. If the escape character must appear at the beginning of a
line, enter it twice.
The actual escape character may be changed by setting the value of
@code{escape} mail variable (@pxref{Mail Variables}).

@menu
* Quitting Compose Mode::
* Getting Help on Compose Escapes::
* Editing the Message::
* Modifying the Headers::
* Enclosing Another Message::
* Adding a File to the Message::
* Printing And Saving the Message::
* Signing the Message::
* Printing Another Message::
* Inserting Value of a Mail Variable::
* Executing Other Mail Commands::
* Executing Shell Commands::
@end menu

@node Quitting Compose Mode
@subsubheading Quitting Compose Mode
@kyindex ~., mail escape
@kyindex ~x, mail escape

There are several commands allowing you to quit the compose mode.

Typing the end-of-file character (@samp{C-D}) on a line alone finishes
compose mode and sends the message to its destination. The @samp{C-D}
character looses its special meaning if @code{ignoreeof} mail variable
is set.

If mail variable @code{dot} is set, typing dot (@samp{.}) on a line
alone achieves the same effect as @samp{C-D} above.

Finally, using @samp{~.} escape always quits compose mode and sends
out the composed message.

To abort composing of a message without sending it, type interrupt
character (by default, @samp{C-C}) twice. This behavior is disabled
when mail variable @code{ignore} is set. In this case, you can use
@samp{~x} escape to achieve the same effect.

@node Getting Help on Compose Escapes
@subsubheading Getting Help on Compose Escapes: ~?
@kyindex ~?, mail escape

The @samp{~?} escape prints on screen a brief summary of the available
compose escapes. @emph{Please note}, that @samp{~h} escape prompts
for changing the header values, and does @emph{not} give help.

@node Editing the Message
@subsubheading Editing the Message: ~e and ~v
@kyindex ~e, mail escape
@kyindex ~v, mail escape

If you are not satisfied with the message as it is, you can edit it
using a text editor specified either by @code{EDITOR} or by
@code{VISUAL} environment variables. The @samp{~e} uses the former,
and @samp{~v} uses the latter.

By default both escapes allow you to edit only the body of the
message. However, if the @code{editheaders} variable is set,
@command{mail} will load into the editor the complete text of
the message with headers included, thus allowing you to change
the headers as well.

@node Modifying the Headers
@subsubheading Modifying the Headers: ~h, ~t, ~c, ~b, ~s

To add new addresses to the list of message recipients, use @samp{~t}
command, e.g.:

@smallexample
~t name1@@domain.net name2
@end smallexample

To add addresses to @code{Cc} or @code{Bcc}, use @samp{~c} or @samp{~b}
escapes respectively.

To change the @code{Subject} header, use @samp{~s} escape, e.g.:

@smallexample
~s "Re: your message"
@end smallexample

Finally, to edit all headers, type @samp{~h} escape. This will present
you with the values of @code{To}, @code{Cc}, @code{Bcc}, and
@code{Subject} headers allowing to edit them with normal text editing
commands.

@node Enclosing Another Message
@subsubheading Enclosing Another Message: ~m and ~M
@kyindex ~m, mail escape
@kyindex ~M, mail escape

If you are sending mail from within mail command mode, you can enclose
the contents of any message sent to you by using @samp{~m} or @samp{~M}
commands. Typing @samp{~m} alone will enclose the contents of the
current message, typing @samp{~m 12} will enclose the contents of
message #12 and so on.

The @samp{~m} uses retained and ignored lists when enclosing headers,
the @samp{~M} encloses all header fields.

In both cases, the contents of @code{indentprefix} mail variable is
prepended to each line enclosed.

@node Adding a File to the Message
@subsubheading Adding a File to the Message: ~r and ~d

To append the contents of file @var{filename} to the message, type

@smallexample
~r @var{filename}
@end smallexample
@noindent
or

@smallexample
~< @var{filename}
@end smallexample
@noindent

The @samp{~d} escape is a shorthand for

@smallexample
~r dead.letter
@end smallexample

@node Printing And Saving the Message
@subsubheading Printing And Saving the Message
@kyindex ~p, mail escape
@kyindex ~w, mail escape

The @samp{~p} escape types the contents of the message entered so far,
including headers, on your terminal. You can save the message to
an arbitrary file using @samp{~w} escape. It takes the filename as its
argument.

@node Signing the Message
@subsubheading Signing the Message: ~a and ~A
@kyindex ~a, mail escape
@kyindex ~A, mail escape

To save you the effort of typing your signature at the end of each
message, you can use @samp{~a} or @samp{~A} escapes. If your signature
occupies one line only, save it to the variable @code{sign} and use
@samp{~a} escape to insert it. Otherwise, if it is longer than one
line, save it to a file, store the name of this file in the
variable @code{Sign}, and use @samp{~A} escape to insert it into
the message.

@node Printing Another Message
@subsubheading Printing Another Message: ~f and ~F
@kyindex ~f, mail escape
@kyindex ~F, mail escape

Sometimes it is necessary to view the contents of another message,
while composing. These two escapes allow it. Both take the message
list as their argument. If they are used without argument, the
contents of the current message is printed. The difference between
@samp{~f} and @samp{~F} is that the former uses ignored and retained
lists to select headers to be displayed, whereas the latter prints
all headers.

@node Inserting Value of a Mail Variable
@subsubheading Inserting Value of a Mail Variable: ~i
@kyindex ~i, mail escape

The @samp{~i} escape enters the value of the named mail variable into
the body of the message being composed.

@node Executing Other Mail Commands
@subsubheading Executing Other Mail Commands: ~: and ~-
@kyindex ~:, mail escape
@kyindex ~-, mail escape

You can execute a mail command from within compose mode using @samp{~:}
or @samp{~-} escapes. For example, typing

@smallexample
~: from :t
@end smallexample
@noindent

will display the from lines of all tagged messages. Note, that executing
mail-sending commands from within the compose mode is not allowed.
An attempt to execute such a command will result in diagnostic message
``Command not allowed in an escape sequence'' being displayed.
Also, when starting compose mode immediately from the shell
(e.g. running @samp{mail address@@domain}), most mail commands are
meaningless, since there is no mailbox to operate upon. In this case,
the only commands that can reasonably be used are: @code{alias},
@code{unalias}, @code{alternate}, @code{set}, and @code{unset}.

@node Executing Shell Commands
@subsubheading Executing Shell Commands: ~! and ~|
@kyindex ~!, mail escape
@kyindex ~|, mail escape

The @samp{~!} escape executes specified command and returns you to
@command{mail} compose mode without altering your message. When used without
arguments, it starts your login shell. The @samp{~|} escape pipes the
message composed so far through the given shell command and replaces the
message with the output the command produced. If the command produced
no output, @command{mail} assumes that something went wrong and retains
the old contents of your message.

@c *********************************************************************

@node Reading Mail
@subsection Reading Mail

To read messages from a given mailbox, use one of the following ways of
invoking @command{mail}:

@table @code
@item mail
To read messages from your system mailbox.
@item mail --file
To read messages from your mailbox (@file{$HOME/mbox}).
@item mail --file=@var{path_to_mailbox}
To read messages from the specified mailbox.
@item mail --user=@var{user}
To read messages from the system mailbox belonging to @var{user}.
@end table

@emph{Please note}, that usual mailbox permissions won't allow you
to use the last variant of invocation, unless you are a super-user.
Similarly, the last but one variant is also greatly affected by the
permissions the target mailbox has.

Unless you have started mail with @option{--norc} command line option,
it will read the contents of the system-wide configuration file.
Then it reads the contents of user configuration file, if any.
For detailed description of these files, see @ref{Mail Configuration Files}.
After this initial setup, @command{mail} displays the first page of header
lines and enters interactive mode. In interactive mode, @command{mail}
displays its prompt (@samp{?}, if not set otherwise) and executes the
commands the user enters.

@menu
* Quitting the Program::
* Obtaining Online Help::
* Moving Within a Mailbox::
* Changing mailbox/directory::
* Controlling Header Display::
* Displaying Information::
* Displaying Messages::
* Marking Messages::
* Disposing of Messages::
* Saving Messages::
* Editing Messages::
* Aliasing::
* Replying::
* Controlling Sender Fields::
* Incorporating New Mail::
* Shell Escapes::
@end menu

@c **********************************
@node Quitting the Program
@subsubheading Quitting the Program

Following commands quit the program:

@table @samp
@item quit
Terminates the session. If @command{mail} was operating upon user's system
mailbox, then all undeleted and unsaved messages that have been read and
are not marked with hold flag are saved to the user's mbox file
(@file{$HOME/mbox}). The messages, marked with @code{delete} are removed.
The program exits to the Shell, unless saving the mailbox fails, in
which case user can escape with the exit command.

@item exit
@itemx ex
@itemx xit
Program exits to the Shell without modifying the mailbox it operates
upon.
@end table

Typing EOF (@samp{C-D}) alone is equivalent to @samp{quit}.

@node Obtaining Online Help
@subsubheading Obtaining Online Help
@kyindex help, mail command
@kyindex ?, mail command
@kyindex list, mail command
@kyindex version, mail command
@kyindex warranty, mail command

Following commands can be used during the session to request online
help:

@table @samp
@item help [@var{command}]
@itemx hel [@var{command}]
@itemx ? [@var{command}]
Display detailed command synopsis. If no @var{command} is given, help for
all available commands is displayed.
@item list
@itemx *
Print a list of available commands.
@item version
@itemx ve
Display program version.
@item warranty
@itemx wa
Display program warranty statement.
@end table

@node Moving Within a Mailbox
@subsubheading Moving Within a Mailbox
@kyindex next, mail command
@kyindex prev, mail command

@table @samp
@item ^
Move to the first undeleted message.
@item $
Move to the last undeleted message.
@item next
@itemx n
Move to the next message.
@item previous
@itemx prev
Move to the previous message.
@end table

@node Changing mailbox/directory
@subsubheading Changing Mailbox/Directory
@kyindex chdir, mail command
@kyindex file, mail command
@kyindex folder, mail command

@table @samp
@item cd [@var{dir}]
@itemx chdir [@var{dir}]
@itemx ch [@var{dir}]
Change to the specified directory. If @var{dir} is omitted, @env{$HOME} is
assumed.
@item file [@var{mailbox}]
@itemx fi [@var{mailbox}]
@itemx folder [@var{mailbox}]
@itemx fold [@var{mailbox}]
Read in the contents of the specified @var{mailbox}. The current mailbox
is updated as if @code{quit} command has been issued.
If @var{mailbox} is omitted, the command prints the current mailbox
name followed by the summary information regarding it, e.g.:

@smallexample
@cartouche
& fold
"/var/spool/mail/gray": 23 messages 22 unread
@end cartouche
@end smallexample
@end table

@node Controlling Header Display
@subsubheading Controlling Header Display
@kyindex discard, mail command
@kyindex ignore, mail command
@kyindex retain, mail command

To control which headers in the message should be displayed, @command{mail}
keeps two lists: a @dfn{retained} header list and an @dfn{ignored}
header list. If @dfn{retained} header list is not empty, only the
header fields listed in it are displayed when printing the message.
Otherwise, if @dfn{ignored} header list is not empty, only the headers
@emph{not listed} in this list are displayed. The uppercase variants
of message-displaying commands can be used to print all the headers.

The following commands modify and display the contents of both lists.

@table @samp
@item discard [@var{header-field-list}]
@itemx di [@var{header-field-list}]
@itemx ignore [@var{header-field-list}]
@itemx ig [@var{header-field-list}]
Add @var{header-field-list} to the ignored list. When used without
arguments, this command prints the contents of ignored list.
@item retain [@var{header-field-list}]
@itemx ret [@var{header-field-list}]
Add @var{header-field-list} to the retained list. When used without
arguments, this command prints the contents of retained list.
@end table

@node Displaying Information
@subsubheading Displaying Information
@kyindex =, mail command
@kyindex headers, mail command
@kyindex from, mail command
@kyindex z, mail command
@kyindex size, mail command
@kyindex folders, mail command
@kyindex summary, mail command

@table @samp
@item =
Displays the current message number.
@item headers [@var{msglist}]
@itemx h [@var{msglist}]
Lists the current pageful of headers.
@item from [@var{msglist}]
@itemx f [@var{msglist}]
Lists the contents of @samp{From} headers for a given set of messages.
@item z [@var{arg}]
Presents message headers in pagefuls as described for @code{headers}
command. When @var{arg} is @samp{.}, it is generally equivalent to
@code{headers}. When @var{arg} is omitted or is @samp{+}, the next
pageful of headers is displayed. If @var{arg} is @samp{-}, the
previous pageful of headers is displayed. The latter two forms
of @code{z} command may also take a numerical argument meaning the
number of pages to skip before displaying the headers. For
example:

@smallexample
& z +2
@end smallexample
@noindent
will skip two pages of messages before displaying the header summary.
@item size [@var{msglist}]
@itemx si [@var{msglist}]
Lists the message number and message size in bytes for each message in
@var{msglist}.
@item folders
Displays the value of @code{folder} variable.
@item summary
@itemx su
Displays current mailbox summary. E.g.:

@smallexample
@cartouche
& summary
"/var/spool/mail/gray": 23 messages 22 unread
@end cartouche
@end smallexample
@end table

@node Displaying Messages
@subsubheading Displaying Messages
@kyindex print, mail command
@kyindex type, mail command
@kyindex Print, mail command
@kyindex Type, mail command
@kyindex decode, mail command
@kyindex top, mail command
@kyindex pipe, mail command
@kyindex |, mail command

@table @samp
@item print [@var{msglist}]
@itemx p [@var{msglist}]
@item type [@var{msglist}]
@itemx t [@var{msglist}]
Prints out the messages from @var{msglist}. The variable @code{crt}
determines the minimum number of lines the body of the message must
contain in order to be piped through pager command specified
by environment variable @code{PAGER}. If @code{crt} is set to a numeric
value, this value is taken as the minimum number of lines. Otherwise,
if @code{crt} is set without a value then the height of the terminal
 screen is used to compute the threshold.  The number of lines on
screen is controlled by @code{screen} variable.
@item Print [@var{msglist}]
@itemx P [@var{msglist}]
@itemx Type [@var{msglist}]
@itemx T [@var{msglist}]
Like print but also prints out ignored header fields.
@item decode [@var{msglist}]
@itemx dec [@var{msglist}]
Print a multipart message. The @code{decode} command decodes and prints
out specified message parts. E.g.
@smallexample
@cartouche
& decode 15[2]
+---------------------------------------
| Message=15[2]
| Type=message/delivery-status
| encoding=7bit
+---------------------------------------
Content-Type: message/delivery-status
...
@end cartouche
@end smallexample
@item top [@var{msglist}]
@itemx to [@var{msglist}]
Prints the top few lines of each message in @var{msglist}.  The number
of lines printed is controlled by the variable @code{toplines} and
defaults to five.
@item pipe [@var{msglist}] [@var{shell-command}]
@itemx | [@var{msglist}] [@var{shell-command}]
Pipe the contents of specified messages through @var{shell-command}. If
@var{shell-command} is empty but the string variable @code{cmd} is set,
the value of this variable is used as a command name.
@end table

@node Marking Messages
@subsubheading Marking Messages
@kyindex tag, mail command
@kyindex hold, mail command
@kyindex preserve, mail command

@table @samp
@item tag [@var{msglist}]
@itemx ta [@var{msglist}]
Tag messages. The tagged messages can be referred to in message list
using @samp{:t} notation.
@item untag [@var{msglist}]
@itemx unt [@var{msglist}]
Clear tags from specified messages. To untag all messages tagged so far
type
@smallexample
& untag :t
@end smallexample
@item hold [@var{msglist}]
@itemx ho [@var{msglist}]
@itemx preserve [@var{msglist}]
@itemx pre [@var{msglist}]
Marks each message to be held in user's system mailbox. This command
does not override the effect of @code{delete} command.
@end table

@node Disposing of Messages
@subsubheading Disposing of Messages
@kyindex delete, mail command
@kyindex undelete, mail command
@kyindex dt, mail command
@kyindex dp, mail command

@table @samp
@item delete [@var{msglist}]
@itemx d [@var{msglist}]
Mark messages as deleted. Upon exiting with @code{quit} command these
messages will be deleted from the mailbox. Until the end of current
session the deleted messages can be referred to in message lists using
:d notation.
@item undelete [@var{msglist}]
@itemx u [@var{msglist}]
Clear delete mark from the specified messages.
@item dp [@var{msglist}]
@itemx dt [@var{msglist}]
Deletes the current message and prints the next message. If
@var{msglist} is specified, deletes all messages from the list and
prints the message, immediately following last deleted one.
@end table

@node Saving Messages
@subsubheading Saving Messages
@kyindex save, mail command
@kyindex Save, mail command
@kyindex write, mail command
@kyindex Write, mail command
@kyindex mbox, mail command
@kyindex touch, mail command
@kyindex copy, mail command
@kyindex Copy, mail command

@table @samp
@item save [[@var{msglist}] @var{file}]
@itemx s [[@var{msglist}] @var{file}]
Takes a message list and a file name and appends each message in turn to
the end of the file. The name of file and number of characters appended
to it is echoed on the terminal. Each saved message is marked for
deletion as if with @code{delete} command, unless the variable
@code{keepsave} is set.
@item Save [@var{msglist}]
@itemx S [@var{msglist}]
Like @code{save}, but the file to append messages to is named after the
sender of the first message in @var{msglist}. For example:

@smallexample
@group
@cartouche
& from 14 15
 U  14 smith@@noldor.org Fri Jun 30 18:11  14/358   The Save c
 U  15 gray@@noldor.org  Fri Jun 30 18:30  8/245    Re: The Sa
& Save 14 15
"smith" 22/603
@end cartouche
@end group
@end smallexample
@noindent

i.e., 22 lines (603 characters) have been appended to the file ``smith''.
If the file does not exist, it is created.

@item write [[@var{msglist}] @var{file}]
@itemx w [[@var{msglist}] @var{file}]
Similar to @code{save}, except that only message body (without the
header) is saved.
@item Write [@var{msglist}]
@itemx W [@var{msglist}]
Similar to @code{Save}, except that only message body (without the
header) is saved.
@item mbox [@var{msglist}]
@itemx mb [@var{msglist}]
@itemx touch [@var{msglist}]
@itemx tou [@var{msglist}]
Mark list of messages to be saved in the user's mailbox (@file{$HOME/mbox})
upon exiting via @code{quit} command. This is the default action for
all read messages, unless you have variable @code{hold} set.
@item copy [[@var{msglist}] @var{file}]
@itemx c [[@var{msglist}] @var{file}]
Similar to @code{save}, except that saved messages are not marked for
deletion.
@item Copy [@var{msglist}]
@itemx C [@var{msglist}]
Similar to @code{Save}, except that saved messages are not marked for
deletion.
@end table

@node Editing Messages
@subsubheading Editing Messages
@kyindex edit, mail command
@kyindex visual, mail command

These command allow to edit messages in a mailbox. @emph{Please note},
that modified messages currently do not replace original ones. i.e.
you have to save them explicitly using your editor's @code{save}
command if you do not want the effects of your editing to be lost.

@table @samp
@item edit [@var{msglist}]
@itemx e [@var{msglist}]
Edits each message in @var{msglist} with the editor, specified in
@code{EDITOR} environment variable.
@item visual [@var{msglist}]
@itemx v [@var{msglist}]
Edits each message in @var{msglist} with the editor, specified in
@code{VISUAL} environment variable.
@end table

@node Aliasing
@subsubheading Aliasing
@kyindex alias, mail command
@kyindex group, mail command
@kyindex unalias, mail command
@kyindex alternates, mail command

@table @samp
@item alias [alias [@var{address}...]]
@itemx a [alias [@var{address}...]]
@itemx group [alias [@var{address}...]]
@itemx g [alias [@var{address}...]]
With no arguments, prints out all currently-defined aliases.
With one argument, prints out that alias.
With more than one argument, creates a new alias or changes an old one.
@item unalias [@var{alias}...]
@itemx una [@var{alias}...]
Takes a list of names defined by alias commands and discards the
remembered groups of users.  The alias names no longer have any
significance.
@item alternates @var{name}...
@itemx alt @var{name}...
The alternates command is useful if you have accounts on several
machines. It can be used to inform mail that the listed addresses are
really you.  When you reply to messages, mail will not send a copy of
the message to any of the addresses listed on the alternates list.
If the alternates command is given with no argument, the current set of
alternate names is displayed.
@end table

@node Replying
@subsubheading Replying
@kyindex mail, mail command
@kyindex reply, mail command
@kyindex Reply, mail command
@kyindex respond, mail command
@kyindex Respond, mail command
@kyindex followup, mail command
@kyindex Followup, mail command

@table @samp
@item mail [@var{address}...]
@itemx m [@var{address}...]
Switches to compose mode. After composing the message, sends messages to
the specified addresses.

@item reply [@var{msglist}]
@itemx respond [@var{msglist}]
@itemx r [@var{msglist}]

For each message in @var{msglist}, switches to compose mode and sends
the composed message to the sender and all recipients of the message.

@item Reply [@var{msglist}]
@itemx Respond [@var{msglist}]
@itemx R [@var{msglist}]

Like @code{reply}, except that the composed message is sent only to
originators of the specified messages.

Notice, that setting mail variable @code{flipr} (@pxref{Mail
Variables}) swaps the meanings of the two above commands,
so that @code{reply} sends the message to the sender and all
recipients of the message, whereas @code{Reply} sends it to
originators only.

@item followup [@var{msglist}]
@itemx fo [@var{msglist}]

Switches to compose mode. After composing, sends the message to the
originators and recipients of all messages in @var{msglist}.

@item Followup [@var{msglist}]
@itemx F [@var{msglist}]

Similar to @code{followup}, but reply message is sent only to
originators of messages in @var{msglist}.
@end table

To determine the sender of the message @command{mail} uses the
list of sender fields (@pxref{Controlling Sender Fields}). The first field
from this list is looked up in message headers. If it is found
and contains a valid email address, this address is used as
the sender address. If not, the second field is searched and
so on. This process continues until a field is found in the
headers, or the sender field list is exhausted, whichever happens
first.

If the previous step did not determine the sender address, the
address from SMTP envelope is used.

Let's illustrate this. Suppose your mailbox contains the following:

@smallexample
@cartouche
 U  1 block@@helsingor.org  Fri Jun 30 18:30  8/245    Re: The Sa
& Print 1
From: Antonius Block <block@@helsingor.org>
To: Smeden Plog <plog@@helsingor.org>
Date: Tue, 27 Apr 2004 13:23:41 +0300
Reply-To: <root@@helsingor.org>
Subject: News

Hi
@end cartouche
@end smallexample

@noindent
Now, you issue the following commands:

@smallexample
@cartouche
& sender mail-followup-to reply-to from
& reply
To: <root@@helsingor.org>
Subject: Re: News

@end cartouche
@end smallexample

@noindent
As you see, the value of @code{Reply-To} field was taken as the
sender address.

Now, let's try the following command sequence:

@smallexample
# Clear the sender list
& nosender
# Set new sender list
& sender From
@end smallexample

@noindent
Now, the @code{From} address will be taken:

@smallexample
@cartouche
& reply
To: Antonius Block <block@@helsingor.org>
Subject: Re: News

@end cartouche
@end smallexample

@node Controlling Sender Fields
@subsubheading Controlling Sender Fields
@kyindex sender, mail command
@kyindex nosender, mail command

Commands @code{sender} and @code{nosender} are used to manipulate
the contents of the sender field list.

If the command @code{sender} is used without arguments, it displays
the contents of the sender field list. If arguments are given,
each argument is appended to the sender field list. For example:

@smallexample
@cartouche
& sender
Sender address is obtained from the envelope
& sender mail-followup-to reply-to
& sender
mail-followup-to
reply-to
& sender from
& sender
mail-followup-to
reply-to
from
@end cartouche
@end smallexample

Command @code{nosender} is used to remove items from the sender
field list:

@smallexample
@cartouche
& sender
mail-followup-to
reply-to
from
& nosender reply-to
& sender
mail-followup-to
from
@end cartouche
@end smallexample

When used without arguments, this command clears the list:

@smallexample
@cartouche
& nosender
Sender address is obtained from the envelope
@end cartouche
@end smallexample

@node Incorporating New Mail
@subsubheading Incorporating New Mail
@kyindex incorporate, mail command

The @code{incorporate} (@code{inc}) command incorporates newly arrived
messages to the displayed list of messages. This is done automatically
before returning to @command{mail} command prompt if the variable
@code{autoinc} is set.

@node Shell Escapes
@subsubheading Shell Escapes
@kyindex shell, mail command
@kyindex !, mail command

To run arbitrary shell command from @command{mail} command prompt, use
@code{shell} (@code{sh}) command. If no arguments are specified, the
command starts the user login shell. Otherwise, it uses its first
argument as a file name to execute and all subsequent arguments are
passed as positional parameters to this command. The @code{shell}
command can also be spelled as @code{!}.

@c **********************************

@node Scripting
@subsection Scripting

@subsubheading Comments

The @samp{#} character introduces an end-of-line comment. All characters
until and including the end of line are ignored.

@subsubheading Displaying Arbitrary Text
@kyindex echo, mail command

The @samp{echo} (@samp{ec}) command prints its arguments to stdout.

@subsubheading Sourcing External Command Files
@kyindex source, mail command

The command @samp{source @var{filename}} reads commands from the named
file. Its minimal abbreviation is @samp{so}.

@subsubheading Setting and Unsetting the Variables
@kyindex set, mail command
@kyindex unset, mail command

The mail variables may be set using @samp{set} (@samp{se}) command. The
command takes a list of assignments. The syntax of an assignment is

@table @samp
@item @var{name}=@var{string}
Assign a string value to the variable. If @var{string} contains
whitespace characters it must be enclosed in a pair of
double-quote characters (@samp{"})
@item @var{name}=@var{number}
Assign a numeric value to the variable.
@item @var{name}
Assign boolean @code{True} value.
@item no@var{name}
Assign boolean @code{False} value.
@end table

Example:

@smallexample
& set askcc nocrt indentprefix="> "
@end smallexample
@noindent

This statement sets @code{askcc} to @code{True}, @code{crt} to
@code{False}, and @code{indentprefix} to ``> ''.

To unset mail variables use @samp{unset}(@samp{uns}) command. The
command takes a list of variable names to unset.

Example:
To undo the effect of the previous example, do:

@smallexample
& unset askcc crt indentprefix
@end smallexample

@subsubheading Setting and Unsetting Shell Environment Variables

Shell environment may be modified using @samp{setenv} (@samp{sete})
command. The command takes a list of assignments. The syntax of an
assignment is:

@table @samp
@item @var{name}=@var{value}
If variable @var{name} does not already exist in the environment,
then it is added to the environment with the value @var{value}.
If @var{name} does exist, then its value in the environment is
changed to @var{value}. 
@item @var{name}
Delete the variable @var{name} from the environment (``unset'' it).
@end table

@subsubheading Conditional Statements
@kyindex if, mail command
@kyindex else, mail command
@kyindex endif, mail command

The conditional statement allows to execute a set of mail commands
depending on the mode the @command{mail} program is in. The conditional
statement is:

@smallexample
if @var{cond}
...
else
...
endif
@end smallexample
@noindent

where @samp{...} represents the set of commands to be executed in each
branch of the statement. @var{cond} can be one of the following:

@table @samp
@item s
True if @command{mail} is operating in mail sending mode.
@item r
True if @command{mail} is operating in mail reading mode.
@item t
True if stdout is a terminal device (as opposed to a regular file).
@end table

The conditional statements can be nested to arbitrary depth. The minimal
abbreviations for @samp{if}, @samp{else} and @samp{endif} commands are
@samp{i}, @samp{el} and @samp{en}.

Example:

@smallexample
if t
set crt prompt="& "
else
unset prompt
endif
if s
alt gray@@farlep.net gray@@mirddin.farlep.net
set
@end smallexample

@node Mail Variables
@subsection How to Alter the Behavior of @command{mail}

Following variables control the behavior of @sc{gnu} @command{mail}:

@table @code
@item appenddeadletter
@*Type: Boolean.
@*Default: False.
@vrindex appenddeadletter, mail variable

If this variable is @code{True}, the contents of canceled letter is
appended to the user's @file{dead.letter} file. Otherwise it overwrites
its contents.

@item askbcc
@*Type: Boolean.
@*Default: False.
@vrindex askbcc, mail variable

When set to @code{True} the user will be prompted to enter @code{Bcc}
field before composing the message.

@item askcc
@*Type: Boolean.
@*Default: True.
@vrindex askcc, mail variable

When set to @code{True} the user will be prompted to enter @code{Cc}
field before composing the message.

@item asksub
@*Type: Boolean.
@*Default: True in interactive mode, False otherwise.
@vrindex asksub, mail variable

When set to @code{True} the user will be prompted to enter @code{Subject}
field before composing the message.

@item autoinc
@*Type: Boolean.
@*Default: True.
@vrindex autoinc, mail variable

Automatically incorporate newly arrived messages.

@item autoprint
@*Type: Boolean.
@*Default: False.
@vrindex autoprint, mail variable

Causes the delete command to behave like dp - thus, after deleting a
message, the next one will be typed automatically.

@item bang
@*Type: Boolean.
@*Default: False.
@vrindex bang, mail variable

When set, every occurrence of @code{!} in arguments to @code{!}
command is replaced with the last executed command.

@item datefield
@*Type: Boolean.
@*Default: False.
@vrindex datefield, mail variable

By default the date in a header summary is taken from the SMTP
envelope of the message. Setting this variable tells @command{mail}
to use the date from @code{Date:} header field, converted to
localtime. Notice, that for messages lacking this field @command{mail}
will fall back to using SMTP envelope.

@item charset
@*Type: string
@*Default: @samp{auto}
@vrindex charset, mail variable

The value of this variable controls the output character set for the
header fields encoding using RFC 2047. If the variable is unset, no
decoding is performed and the fields are printed as they are. If the
variable is set to @samp{auto}, @command{mail} tries to deduce the
name of the character set from the value of @code{LC_ALL} environment
variable. Otherwise, its value is taken as the name of the charset.

@item cmd
@*Type: String.
@*Default: Unset.
@vrindex cmd, mail variable

Contains default shell command for @code{pipe}.

@item columns
@*Type: Numeric.
@*Default: Detected at startup by querying the terminal device. If this
fails, the value of environment variable @code{COLUMNS} is used.
@vrindex columns, mail variable

This variable contains the number of columns on terminal screen.

@item crt
@*Type: Boolean or Numeric
@*Default: True in interactive mode, False otherwise.
@vrindex crt, mail variable

The variable @code{crt} determines the minimum number of lines the body
of the message must contain in order to be piped through pager command
specified by environment variable @code{PAGER}. If @code{crt} is set
to a numeric value, this value is taken as the threshold. Otherwise,
if @code{crt} is set without a value, then the height of the terminal
screen is used to compute the threshold.  The number of lines on
screen is controlled by @code{screen} variable.

@item decode-fallback
@*Type: String.
@*Default: @samp{none}.
@vrindex decode-fallback, mail variable

This variable controls the way to represent characters that cannot
be rendered using current character set. It can have three values:

@table @samp
@item none
Such characters are not printed at all. The conversion process stops
at the first character that cannot be rendered.

@item copy-pass
The characters are displayed @samp{as is}. Notice, that depending on
your setup, this may screw-up your terminal settings.

@item copy-octal
Unprintable characters are represented by their octal codes. Printable
ones are printed @samp{as is}.
@end table

@item dot
@*Type: Boolean.
@*Default: False.
@vrindex dot, mail variable

If @code{True}, causes @command{mail} to interpret a period alone on a line as the
terminator of a message you are sending.

@item emptystart
@*Type: Boolean.
@*Default: False.
@vrindex emptystart, mail variable

If the mailbox is empty, @command{mail} normally prints @samp{No mail for user} and
exits immediately. If this option is set, @command{mail} will start no matter is
the mailbox empty or not.

@item editheaders
@*Type: Boolean.
@*Default: False.
@vrindex editheaders, mail variable

When set, @command{mail} will include message headers in the text to
be the @code{~e} and @code{~v} escapes, thus allowing you to customize
the headers.

@item escape
@*Type: String.
@*Default: ~
@vrindex escape, mail variable

If defined, the first character of this option gives the character to
denoting escapes.

@item flipr
@*Type: Boolean
@*Default: Unset
@vrindex flipr, mail variable

The variable @code{flipr} if set swaps the meanings of @code{reply}
and @code{Reply} commands (@pxref{Replying}).

@item folder
@*Type: String.
@*Default: Unset.
@vrindex folder, mail variable

The name of the directory to use for storing folders of messages. If
unset, @env{$HOME} is assumed.

@item header
@*Type: Boolean.
@*Default: True, unless started with @option{--nosum} (@option{-N}) option.
@vrindex header, mail variable

Whether to run @code{headers} command automatically after entering
interactive mode.

@item hold
@*Type: Boolean.
@*Default: False.
@vrindex hold, mail variable

When set to @code{True}, the read or saved messages will be stored in
user's mailbox (@file{$HOME/mbox}). Otherwise, they will be held in
system mailbox also. This option is in effect only when operating
upon user's system mailbox.

@item ignore
@*Type: Boolean.
@*Default: False.
@vrindex ignore, mail variable

When set to @code{True}, @command{mail} will ignore keyboard interrupts
when composing messages. Otherwise an interrupt will be taken as a
signal to abort composing.

@item ignoreeof
@*Type: Boolean.
@*Default: False.
@vrindex ignoreeof, mail variable

Controls whether typing EOF character terminates the letter being
composed.

@item indentprefix
@*Type: String.
@*Default: "\t" (a tab character).
@vrindex indentprefix, mail variable

String used by the @code{~m} tilde escape for indenting quoted messages.

@item inplacealiases
@*Type: Boolean
@*Default: False

If set, @command{mail} will expand aliases in the address header field
before entering send mode (@pxref{Composing Mail}). By default, the
address header fields are left intact while composing, the alias
expansion takes place immediately before sending message.

@item keepsave
@*Type: Boolean.
@*Default: False.
@vrindex keepsave, mail variable

Controls whether saved messages should be kept in system mailbox too.
This variable is in effect only when operating upon a user's system
mailbox.

@item mailx
@*Type: Boolean.
@*Default: False.
@vrindex mailx, mail variable

When set, enables @dfn{mailx compatibility mode}. This mode
has the following effects:

@itemize @bullet
@item When composing a message @command{mail} will ask
for @code{Cc} and @code{Bcc} addresses after composing the body.
The default behavior is to ask for these values before composing
the body.

@item In send mode, if the composition was interrupted, @command{mail}
will exit with zero status. By default it exits with zero status only
if the message was sent successfully.
@end itemize

@item metamail
@*Type: Boolean or String.
@*Default: True.
@vrindex metamail, mail variable

This variable controls operation of @code{decode} command. If
it is unset, @code{decode} will not attempt any interpretation
of the content of message parts. Otherwise, if @code{metamail}
is set to @code{true}, @code{decode} will use internal metamail
support to interpret message parts. Finally, if @code{metamail}
is assigned a string, this string is treated as command line of
the external @command{metamail} command which will be used to
display parts of a multipart message. For example:

@smallexample
# Disable MIME interpretation:
set nometamail
# Enable built-in MIME support:
set metamail
# Use external program to display MIME parts:
set metamail="metamail -m mail -p"
@end smallexample

@item mimenoask
@*Type: String
@*Default: Empty
@vrindex mimenoask, mail variable

By default @command{mail} asks for comnfirmation before running
interpreter to view a part of the multi-part message. If this variable
is set, its value is treated as a comma-separated list of MIME types
for which no confirmation is needed. Elements of this list may include
shell-style globbing patterns, e.g. setting

@smallexample
set mimenoask=text/*,image/jpeg
@end smallexample

@noindent
will disable prompting before displaying any textual files, no
matter what their subtype is, and before displaying files with
type @samp{image/jpeg}.

@item metoo
@*Type: Boolean.
@*Default: False.
@vrindex metoo, mail variable

Usually, when an alias is expanded that contains the sender, the sender
is removed from the expansion.  Setting this option causes the sender to
be included in the group.

@item mode
@*Type: String.
@*Default: The name of current operation mode.
@vrindex mode, mail variable

Setting this variable does not affect the operation mode of the program.

@item nullbody
@* Type: Boolean
@* Default: True
@vrindex nullbody, mail variable

Controls whether @command{mail} accepts messages with an empty
body.  The default value, @code{true}, means such messages are sent,
and a warning (traditionally saying @samp{Null message body; hope
that's ok}) is displayed.  The text of the warning can be set using
@code{nullbodymsg} variable (see below).

If @code{nullbody} is unset, @command{mail} will silently ignore such
messages.  This can be useful in @file{crontab} files, to avoid sending
mails when nothing important happens.  For example, the @file{crontab}
entry below will send mail only if the utility @command{some-prog}
outputs something on its standard output or error:

@smallexample
@group
*/5 * * * * some-prog 2>&1 | \
   /bin/mail -E'set nonullbody' -s 'Periodic synchronization'
@end group
@end smallexample

@item nullbodymsg
@*Type: String
@*Default: Null message body; hope that's ok 
@vrindex nullbodymsg

Keeps the text of the warning, displayed by @command{mail} before
sending an empty message.  When available, the translation of
this text, in accordance with the current locale, is displayed.

Unsetting this variable disables the warning.

@item outfolder
@*Type: String.
@*Default: Unset.
@vrindex outfolder, mail variable

Contains the directory in which files created by @code{save},
@code{write}, etc. commands will be stored. When unset, current
directory is assumed.

@item page
@*Type: Boolean.
@*Default: False.
@vrindex page, mail variable

If set to @code{True}, the @code{pipe} command will emit a linefeed
character after printing each message.

@item prompt
@*Type: String.
@*Default: "? "
@vrindex prompt, mail variable

Contains the command prompt sequence.

@item quit
@*Type: Boolean.
@*Default: False, unless started with @option{--quit} (@option{-q}) option.
@vrindex quit, mail variable

When set, causes keyboard interrupts to terminate the program.

@item rc
@*Type: Boolean.
@*Default: True, unless started with @option{--norc} (@option{-N}) option.
@vrindex rc, mail variable

When this variable is set, @command{mail} will read the system-wide
configuration file upon startup. See @ref{Mail Configuration Files}.

@item record
@*Type: String.
@*Default: Unset.
@vrindex record, mail variable

When set, any outgoing message will be saved to the named file.

@item recursivealiases
@*Type: Boolean
@*Default: True

When set, @command{mail} will expand aliases recursively.

@item regex
@*Type: Boolean.
@*Default: True.
@vrindex regex, mail variable

Setting this to @code{True} enables use of regular expressions in
@samp{/.../} message specifications.

@item replyprefix
@*Type: String
@*Default: @samp{Re: }
@vrindex replyprefix, mail variable

Sets the prefix that will be used when constructing the subject line
of a reply message.

@item replyregex
@*Type: String
@*Default: @samp{^re: *}
@vrindex replyregex, mail variable

Sets the regular expression used to recognize subjects of reply
messages. If the @code{Subject} header of the message matches this
expression, the value of @code{replyprefix} will not be prepended to
it before replying. The expression should be a POSIX extended regular
expression. The comparison is case-insensitive.

For example, to recognize usual English, Polish, Norwegian and German
reply subject styles, use:

@smallexample
set replyregex="^(re|odp|aw|ang)(\\[[0-9]+\\])?:[[:blank:]]"
@end smallexample

@noindent
(Notice the quoting of backslash characters).

@item save
@*Type: Boolean.
@*Default: True.
@vrindex save, mail variable

When set, the aborted messages will be stored in the user's
@file{dead.file}. See also @code{appenddeadletter}.

@item screen
@*Type: Numeric.
@*Default: Detected at startup by querying the terminal device. If this
fails, the value of environment variable @code{LINES} is used.
@vrindex screen, mail variable

This variable contains the number of lines on terminal screen.

@item sendmail
@*Type: String.
@*Default: sendmail:/usr/lib/sendmail
@vrindex sendmail, mail variable

Contains the URL of mail transport agent.

@item Sign
@*Type: String.
@*Default: Unset.
@vrindex Sign, mail variable

Contains the filename holding users signature. The contents of this
file is appended to the end of a message being composed by @code{~A}
escape.

@item sign
@*Type: String.
@*Default: Unset.
@vrindex sign, mail variable

Contains the user's signature. The contents of this variable is appended
to the end of a message being composed by @code{~a} escape. Use
@code{Sign} variable, if your signature occupies more than one line.

@item showto
@*Type: Boolean
@*Default: unset
@vrindex showto, mail variable

If this variable is set, @command{mail} will show @code{To:} addresses
instead of @code{From:} for all messages that come from the user that
invoked the program.

@item subject
@*Type: String.
@*Default: Unset.
@vrindex subject, mail variable

Contains default subject line. This will be used when @code{asksub} is
off.

@item toplines
@*Type: Numeric.
@*Default: 5
@vrindex toplines, mail variable

Number of lines to be displayed by @code{top} and @code{Top} commands.

@item verbose
@*Type: Boolean.
@*Default: False.
@vrindex verbose, mail variable

When set, the actual delivery of messages is displayed on the user's terminal.

@item xmailer
@*Type: Boolean.
@*Default: Set.
@vrindex xmailer, mail variable

Controls whether the header @samp{X-Mailer} should be added to 
outgoing messages. The default value of this header is

@smallexample
X-Mailer: mail (GNU Mailutils @value{VERSION})
@end smallexample

@end table

@node Mail Configuration Files
@subsection Personal and System-wide Configuration Files

Upon startup, @command{mail} reads the contents of the two command files:
the system-wide configuration file, and the user's configuration
file. Each line read from these files is processed like a usual
@command{mail} command.

When run with @option{--norc} (@option{-N}) option, @command{mail} does
not read the contents of system-wide configuration file. The user's
file, if it exists, is always processed.

The user's configuration file is located in the user's home
directory and is named @file{.mailrc}. The location and name of
the system-wide configuration file is determined when configuring the
package via @option{--with-mail-rc} option. It defaults to
@file{@var{sysconfdir}/mail.rc}.

@page
@node messages
@section @command{messages} --- Count the Number of Messages in a Mailbox
@pindex messages

@command{Messages} prints on standard output the number of messages
contained in each folder specified in command line. If no folders
are specified, it operates upon user's system mailbox. For each
folder, the following output line is produced:

@smallexample
Number of messages in @var{folder}: @var{number}
@end smallexample

@noindent
where @var{folder} represents the folder name, @var{number} represents
the number of messages.

The program uses following option groups: @xref{mailbox}.

The program accepts following command line options:

@table @option
@item -q
@itemx --quiet
@itemx -s
@itemx --silent
Be quiet. Display only number of messages per mailbox, without leading text.
@item -?
@itemx --help
Output help message and exit.
@item --usage
Output short usage summary and exit.
@item -V
@itemx --version
Output program version and exit.
@end table

@page
@node movemail
@section @command{movemail} --- Moves Mail from the User Maildrop to the Local File
@pindex movemail

The purpose of @command{movemail}, as its name implies, is to move mail
from one location to another. For example, the following invocation:

@smallexample
movemail /var/mail/smith INBOX
@end smallexample

@noindent
moves messages from file @file{/var/mail/smith} to file @file{INBOX}.

You will probably never have to run this program manually. It is
intended as a replacement for @command{movemail} from GNU Emacs. The
@command{movemail} program is run by Emacs @code{Rmail}
module. @xref{Rmail,,,emacs,Reading Mail with Rmail}, for detailed
description of @code{Rmail} interface.

Mailutils version of @command{movemail} is completely
backward-compatible with its Emacs predecessor, so it should run
flawlessly with older versions of Emacs. Emacs version 21.4, which is
being developed at the time of this writing, will contain improved
@code{Rmail} interface for work with mailutils @command{movemail}.

@menu
* Movemail Options::     Description of the Available Options
* Summary::              Short Movemail Invocation Summary
@end menu

@node Movemail Options
@subsection Movemail Options

This subsection discusses @command{movemail} options from the point of
view of an Emacs @code{Rmail} user.

To set various options to @command{movemail} from @code{Rmail}, use
@code{rmail-movemail-flags} variable, or @samp{Rmail Movemail Flags}
section from the menu. 

Some POP servers return messages in reversed order. To fix the
order, use @option{-p} option or its synonym @option{--reverse}.

If the remote server supports @acronym{TLS} encryption, use
@option{--tls} to instruct @command{movemail} to initiate encrypted
connection.

Quite a few options control how @command{movemail} handles mail
locking (a way of preventing simultaneous access to the source
mailbox). By default, before accessing mailbox @var{file},
@command{movemail} will first see if the file named
@file{@var{file}.lock} (so called @dfn{lock file}) exists. If so, it
will assume that the mailbox is being used by another program and will
sleep one second. If @file{@var{file}.lock} file disappears after this
wait period, the program will proceed. Otherwise, it will repeat this
action ten times. If after ten wait periods the lock file does not
disappear, @command{movemail} gives up and exits.

If the lock file does not exist, @command{movemail} will create it,
thereby indicating to other programs that the mailbox is being used,
and will proceed to copying messages to the destination file. When
finished, @command{movemail} closes the mailbox and removes the lock
file.

Several options control this behavior. To change the default sleep period
use @option{--lock-retry-timeout}. Its argument is the timeout value
in seconds.

To change number of retries, use @option{--lock-retry-count}. For
example, setting @code{rmail-movemail-flags} to

@smallexample
--lock-retry-timeout=2 --lock-retry-count=5
@end smallexample

@noindent
instructs @command{movemail} to make five attempts to acquire the lock
file, with two-second intervals between the attempts.

You may also force @command{movemail} to remove the lock file if it is
older than a given amount of time (a so called @dfn{stale lock
file}). To do so, use the following option:

@smallexample
--lock-expire-timeout=@var{seconds}
@end smallexample

The @option{--lock-expire-timeout} sets the number of seconds after
which a lock file is considered stale.

There are special programs that can be used to lock and unlock
mailboxes. A common example of such programs is @command{dotlock}. If
you wish to use such @dfn{external locking program} instead of the
default mailutils locking mechanism, use option
@option{--external-locker}. Argument to this option specifies the full
name of the external program to use.

@node Summary
@subsection Summary of Movemail Usage

@smallexample
movemail [@var{option}...] @var{inbox} @var{destfile} [@var{remote-password}]
@end smallexample

The first argument, @var{inbox}, is the @acronym{url} (@pxref{URL}) of
the source mailbox. The second argument, @var{destfile}, traditionally
means destination file, i.e. the UNIX mailbox to copy messages
to. However, mailutils @command{movemail} extends the meaning of this
parameter. You may actually specify any valid @acronym{url} as
@var{destfile} parameter.@footnote{Rmail does not use this
feature}. Finally, optional third argument is a traditional way of
specifying user passwords for remote (@acronym{POP} or @acronym{IMAP})
mailboxes.

Following is the summary of available command line options:

@table @option
@item --emacs
Output information used by Emacs rmail interface

@item -p
@itemx --preserve
@itemx --keep-messages
Preserve the source mailbox

@item -r
@itemx --reverse
Reverse the sorting order

@item --license
Print GPL license and exit

@item --external-locker=@var{program}
Use given @var{program} as the external locker program.

@item --lock-expire-timeout=@var{seconds}
Set number of seconds after which the lock expires

@item --lock-flags=@var{flags}
Set locker flags. @var{flags} is composed of the following letters:
@samp{E} -- use external locker program @command{dotlock},
@samp{R} -- retry 10 times if acquiring of the lock failed (see also
@option{--lock-retry-count} below), @samp{T} -- remove stale locks
after 10 minutes (see also @option{--lock-expire-timeout},
and @samp{P} -- write process @acronym{PID} to the lock file.

@item --lock-retry-count=@var{number}
Set the maximum number of times to retry acquiring the lockfile

@item --lock-retry-timeout=@var{seconds}
Set timeout for acquiring the lockfile

@item -m @var{url}
@itemx --mail-spool @var{URL}
Use specified URL as a mailspool directory

@item --tls[=@var{bool}]
Enable (default) or disable TLS support

@end table

@page
@node readmsg
@section @command{readmsg} --- Extract Messages from a Folder
@pindex readmsg

The program, readmsg, extracts with the selection argument messages from
a mailbox.  Selection can be specify by:

@enumerate
@item A lone ``*'' means select all messages in the mailbox.

@item
A list of message numbers may be specified.  Values
of  ``0''  and ``$'' in the list both mean the last
message in the mailbox.  For example:
@smallexample
readmsg 1 3 0
@end smallexample
extracts  three messages from the folder:  the first, the third, and the last.

@item
Finally, the selection may be some text to match.  This  will  select  a  mail
message which exactly matches the specified text.  For example,
@smallexample
readmsg staff meeting
@end smallexample
extracts the message which contains the words ``staff meeting.''  Note that it
will not match a message containing ``Staff Meeting'' - the matching  is  case
sensitive.   Normally only the first message which matches the pattern will be
printed.
@end enumerate

@subsubheading Command line options

@table @option

@item -a
@itemx --show-all
If a pattern is use for selection show all messages that match pattern
by default only the first one is presented.

@item -d
@itemx --debug
Display mailbox debugging information.

@item -f @var{mailbox}
@itemx --folder=@var{mailbox}
Specified the default mailbox.

@item -h
@itemx --header
Show the entire header and ignore the weedlist.

@item -n
@itemx --no-header
Do not print the message header.

@item -p
@itemx --form-feed
Put form-feed (Control-L) between messages instead of newline.

@item  -w @var{weedlist}
@itemx --weedlist=@var{weedlist}
A whitespace or coma separated list of header names to show per message.
Default is --weedlist=''From Subject Date To CC Apparently-''
@end table

@page
@node sieve
@section @command{sieve}
@pindex sieve

Sieve is a language for filtering e-mail messages at time of final
delivery, described in RFC 3028. @sc{gnu} Mailutils provides two
implementations of this language: a stand-alone @dfn{sieve interpreter}
and a @dfn{sieve translator and filter}. The following sections describe these
utilities in detail.

@menu
* sieve interpreter::   A Sieve Interpreter
* sieve.scm::           A Sieve to Scheme Translator and Filter
@end menu

@node sieve interpreter
@subsection A Sieve Interpreter

Sieve interpreter @command{sieve} allows to apply Sieve scripts to an
arbitrary number of mailboxes. @sc{gnu} @command{sieve} implements a superset
of the Sieve language as described in RFC 3028. @xref{Sieve Language},
for a description of the Sieve language. @xref{GNU Extensions}, for a
discussion of differences between the @sc{gnu} implementation of Sieve and
its standard.

@menu
* Invoking Sieve::
* Logging and Debugging::
* Extending Sieve::
@end menu

@node Invoking Sieve
@subsubheading Invoking @command{sieve}

The @command{sieve} invocation syntax is:

@smallexample
sieve [@var{options}] @var{script}
@end smallexample

@noindent
where @var{script} denotes the filename of the sieve program to parse,
and @var{options} is one or more of the following:

@table @option
@item -c
@itemx --compile-only
Compile script and exit.

@item -d[@var{flags}]
@itemx --debug[=@var{flags}]
Specify debug flags. The @var{flags} argument is a sequence of one or
more of the following letters:

@multitable @columnfractions .40 .45
@item @samp{g} @tab Enable main parser traces
@item @samp{T} @tab Enable mailutil traces
@item @samp{P} @tab Trace network protocols
@item @samp{t} @tab Enable sieve trace
@item @samp{i} @tab Trace the program instructions
@end multitable

@item -D
@itemx --dump
Compile the script, dump disassembled code on standard output and exit.

@item -e @var{address}
@itemx --email @var{address}
Override the user email address. This is useful for @code{reject} and
@code{redirect} actions. By default, the user email address is deduced
from the user name and the full name of the machine where sieve is
executed.

@item -f
@itemx --mbox-url=@var{mbox}
Mailbox to sieve (defaults to user's system mailbox)

@item -k
@itemx --keep-going
Keep on going if execution fails on a message

@item -n
@itemx --no-actions
Dry run: do not execute any actions, just print what would be done.

@item -t @var{ticket}
@itemx --ticket=@var{ticket}
Ticket file for mailbox authentication

@item -v
@itemx --verbose
Log all actions executed.
@end table

Apart from these, @command{sieve} understands the options from the
following groups: @code{sieve}, @code{mailbox}, @code{mailer},
@code{logging}.

@node Logging and Debugging
@subsubheading Logging and debugging

The default behavior of @command{sieve} is to remain silent about
anything except errors. However, it is sometimes necessary to see
which actions are executed and on which messages. This is particularly
useful when debugging the sieve scripts. The @option{--verbose}
(@option{-v}) option outputs log of every action executed.

Option @option{--debug} allows to produce even more detailed debugging
information. This option takes an argument specifying the
debugging level to be enabled. The argument can consist of the
following letters:

@table @samp
@item @samp{t}
This flag enables sieve tracing. It means that every test will be logged
when executed.

@item @samp{T}
This flag enables debugging of underlying @code{mailutils} library.

@item @samp{P}
Trace network protocols: produces log of network transactions executed
while running the script.

@item @samp{g}
Enable main parser traces. This is useful for debugging the sieve grammar.

@item @samp{i}
Trace the program instructions. It is the most extensive debugging
level. It produces the full execution log of a sieve program, showing
each instruction and states of the sieve machine. It is only useful
for debugging the code generator.
@end table

@emph{Note}, that there should be no whitespace
between the short variant of the option (@option{-d}), and its
argument.  Similarly, when using long option (@option{--debug}),
its argument must be preceded by equal sign.

If the argument to @option{--debug} is omitted, it defaults to
@samp{TPt}. 

Option @option{--dump} produces the disassembled dump of the compiled
sieve program. 

By default @command{sieve} output all diagnostics on standard error and verbose
logs on standard output. This behaviour is changed when
@option{--log-facility} is given in the command line (@pxref{logging}).
This option causes @command{sieve} to output its diagnostics to
the given syslog facility.

@node Extending Sieve
@subsubheading Extending @command{sieve}

The basic set of sieve actions, tests and comparators may be extended
using loadable extensions. Usual @code{require} mechanism is used for
that.

When processing arguments for @code{require} statement, @command{sieve}
uses the following algorithm:

@enumerate 1
@item Look up the name in a symbol table. If the name begins with
@samp{comparator-} it is looked up in the comparator table. If it
begins with @samp{test-}, the test table is used instead. Otherwise
the name is looked up in the action table.

@item If the name is found, the search is terminated.

@item Otherwise, transform the name. First, any @samp{comparator-} or
@samp{test-} prefix is stripped. Then, any character other than
alphanumeric characters, @samp{.} and @samp{,} is replaced with
dash (@samp{-}). The name thus obtained is used as a file name
of an external loadable module. 

@item Try to load the module. The module is searched in the
following search paths (in the order given):

@enumerate 1
@item Mailutils module directory. By default it is
@file{$prefix/lib/mailutils}.

@item The value of the environment variable @env{LTDL_LIBRARY_PATH}.

@item Additional search directories specified with the
@code{#searchpath} directive.

@item System library search path: The system dependent library
search path (e.g. on Linux it is set by the contents of the file
@file{/etc/ld.so.conf} and the value of the environment variable
@env{LD_LIBRARY_PATH}).
@end enumerate

The value of @env{LTDL_LIBRARY_PATH} and @env{LD_LIBRARY_PATH} must be
a colon-separated list of absolute directories, for example,
@samp{"/usr/lib/mypkg:/lib/foo"}.

In any of these directories, @command{sieve} first attempts to find
and load the given filename. If this fails, it tries to append the
following suffixes to the file name:

@enumerate 1
@item the libtool archive extension @samp{.la}

@item the extension used for native dynamic libraries on the host
platform, e.g., @samp{.so}, @samp{.sl}, etc.
@end enumerate

@item If the module is found, @command{sieve} executes its
initialization function (see below) and again looks up the name
in the symbol table. If found, search terminates successfully.

@item If either the module is not found, or the symbol wasn't
found after execution of the module initialization function,
search is terminated with an error status. @command{sieve} then displays
the following diagnostic message:

@smallexample
source for the required action NAME is not available
@end smallexample
@end enumerate
 
@c ***********************************************************************

@page
@node sieve.scm
@subsection A Sieve to Scheme Translator and Filter

A Sieve to Scheme Translator @command{sieve.scm} translates a given
Sieve script into an equivalent Scheme program and optionally executes
it. The program itself is written in Scheme and requires presence of
Guile 1.4 on the system. For more information on Guile refer to
@ref{Top,,Overview,guile,The Guile Reference Manual}.

@table @option
@item -f @var{filename}
@itemx --file @var{filename}
Set input file name.

@item -o @var{filename}
@itemx --output @var{filename}
Set output file name

@item -L @var{dirname}
@itemx --lib-dir @var{dirname}
Set sieve library directory name

@item -d @var{level}
@itemx --debug @var{level}
Set debugging level
@end table            

The Scheme programs produced by @command{sieve.scm} can be used with
@command{guimb} or @command{mail.local}.

@c ***********************************************************************

@page
@node guimb
@section @command{guimb} --- A Mailbox Scanning and Processing Language
@pindex guimb

@command{Guimb} is for mailboxes what @command{awk} is for text files.
It processes mailboxes, applying the user-supplied scheme procedures
to each of them in turn and saves the resulting output in mailbox
format.

The program uses following option groups: @xref{mailbox}.

@menu
* Specifying Scheme Program to Execute::
* Specifying Mailboxes to Operate Upon::
* Passing Options to Scheme::
* Command Line Option Summary::
@end menu

@node Specifying Scheme Program to Execute
@subheading Specifying Scheme Program to Execute

The Scheme program or expression to be executed is passed to
@command{guimb} via the following options:

@table @option
@item -s @var{file}
@itemx --source @var{file}
Load Scheme source code from @var{file}.
@item -c @var{expr}
@itemx --code @var{expr}
Execute given scheme expression.
@end table

The above switches stop further argument processing, and pass all
remaining arguments as the value of @code{(command-line)}.

If the remaining arguments must be processed by @command{guimb} itself,
use following options:

@table @option
@item -e @var{expr}
@itemx --expression @var{expr}
Execute scheme expression.
@item -f @var{file}
@itemx --file @var{file}
Load Scheme source code from @var{file}.
@end table

You can specify both of them. In this case, the @var{file} is read
first, then @var{expr} is executed. You may still pass any additional
arguments to the script using @option{--guile-arg} option.

@node Specifying Mailboxes to Operate Upon
@subheading Specifying Mailboxes to Operate Upon

There are four basic ways of passing mailboxes to @command{guimb}.

@table @code
@item guimb [@var{options}] [@var{mailbox}...]
The resulting mailbox is not saved, unless the user-supplied
scheme program saves it.
@item guimb [@var{options}] --mailbox @var{defmbox}
The contents of @var{defmbox} is processed and is replaced with the resulting
mailbox contents. Useful for applying filters to user's mailbox.
@item guimb [@var{options}] --mailbox @var{defmbox} @var{mailbox} [@var{mailbox}...]
The contents of specified mailboxes is processed, and the resulting
mailbox contents is appended to @var{defmbox}.
@item guimb [@var{options}] --user @var{username} [@var{mailbox}...]
The contents of specified mailboxes is processed, and the resulting
mailbox contents is appended to the user's system mailbox. This allows
to use @command{guimb} as a mail delivery agent.
@end table

If no mailboxes are specified in the command line, @command{guimb} reads
and processes the system mailbox of the current user.

@node Passing Options to Scheme
@subheading Passing Options to Scheme

Sometimes it is necessary to pass some command line options to the
scheme procedure. There are three ways of doing so.

When using @option{--source} (@option{-s}) or @option{--code}
(@option{-c}) options, all the rest of the command line following
the option's argument is passed to Scheme program verbatim. This
allows for making guimb scripts executable by the shell. If your system
supports @samp{#!} magic at the start of scripts, add the following two
lines to the beginning of your script to allow for its immediate execution:

@smallexample
#! /usr/local/bin/guimb -s
!#
@end smallexample

@noindent
(replace @samp{/usr/local/bin/} with the actual path to the @command{guimb}).

Otherwise, if you use @option{--file} or @option{--expression} options,
the additional arguments may be passed to the Scheme program @option{-g}
(@option{--guile-arg}) command line option. For example:

@smallexample
guimb --guile-arg -opt --guile-arg 24 --file @var{progfile}
@end smallexample

In this example, the scheme procedure will see the following command line:

@smallexample
@var{progfile} -opt 24
@end smallexample

Finally, if there are many arguments to be passed to Scheme, it is more
convenient to enclose them in @option{-@{} and @option{-@}} escapes:

@smallexample
guimb -@{ -opt 24 -@} --file @var{progfile}
@end smallexample

@node Command Line Option Summary
@subheading Command Line Option Summary

This is a short summary of the command line options available to
@command{guimb}.

@table @option
@item -d
@itemx --debug
Start with debugging evaluator and backtraces.
@item -e @var{expr}
@itemx --expression @var{expr}
Execute given Scheme expression.
@item -m @var{path}
@itemx --mail-spool=@var{path}
Set path to the mailspool directory
@item -f @var{progfile}
@itemx --file @var{progfile}
Read Scheme program from @var{progfile}.
@item -g @var{arg}
@itemx --guile-command @var{arg}
Append @var{arg} to the command line passed to Scheme program.
@item -@{ ... -@}
Pass all command line options enclosed between @option{-@{} and @option{-@}}
to Scheme program.
@item -m
@itemx --mailbox @var{mbox}
Set default mailbox name.
@item -u
@itemx --user @var{name}
Act as local MDA for user @var{name}.
@item -h
@itemx --help
Display help message.
@item  -v
@itemx --version
Display program version.
@end table

@page
@node mail.local
@section @command{mail.local} --- Deliver Mail to the Local Mailbox
@pindex mail.local

@command{mail.local} reads the standard input up to an end-of-file
and appends the received data to the local mailboxes.

@menu
* Invocation::     Mail.local options
* MTA::            Using mail.local with various MTAs
* Mailbox Quotas:: Setting up mailbox quotas.
* Sieve Filters::  Implementing user-defined Sieve mail filters.
* Scheme Filters:: Implementing user-defined Scheme mail filters. 
@end menu

@node Invocation
@subsection Invoking @command{mail.local}

General usage of @command{mail.local} program is:
                                                                                
@smallexample
      mail.local [@var{option}...] @var{recipient} [@var{recipient} ...]
@end smallexample

@noindent
If recipient part is present is a FQDN, @command{mail.local} 
will attempt to deliver to a virtual host.
                                                                                
The program uses following option groups: @xref{mailbox}, @xref{auth},
@xref{logging}, @xref{sieve}.

@table @option
@item -f @var{addr}
@itemx --from @var{addr}
Specify the sender's name. This option forces @command{mail.local} to
add @samp{From } envelope to the beginning of the message. If it is
not specified, @command{mail.local} first looks into the first line
from the standard input. If it starts with @samp{From }, it is assumed
to contain a valid envelope. If it does not, @command{mail.local}
creates the envelope by using current user name and date.

@item -h
@itemx --help
Display usage summary and exit.

@item -L
@itemx --license
Display @sc{gnu} General Public License and exit.

@item -m @var{path}
@itemx --mail-spool @var{path}
Specify path to mailspool directory.

@item -q
@itemx --quota-db @var{file}
Specify path to DBM mailbox quota database (@pxref{Mailbox Quotas}). 

@item --quota-query
Specify SQL query that should be used to obtain user mailbox
quotas from the SQL database (@pxref{Mailbox Quotas}).

@item -s @var{pattern}
@itemx --source @var{pattern}
Set name pattern for user-defined mail filters written in Scheme
(@pxref{Scheme Filters}). The
metacharacters @samp{%u} and @samp{%h} in the pattern are expanded to
the current recipient user name and home directory correspondingly.

This option is available only if the package has been configured to
use Guile extension language.
@item -S @var{pattern}
@itemx --sieve @var{pattern}
Set name pattern for user-defined mail filters written is Sieve
(@pxref{Sieve Filters}). The
metacharacters @samp{%u} and @samp{%h} in the pattern are expanded to
the current recipient user name and home directory correspondingly.
@item -t @var{number}
@itemx --timeout @var{number}
Wait @var{number} seconds for acquiring the lockfile. If it doesn't
become available after that amount of time, return failure. The timeout
defaults to 5 minutes.
@item -x @var{flags}
@itemx --debug @var{flags}
Enable debugging. The debugging information will be output using syslog.
The @var{flags} is a string consisting of the following flags:
Debug flags are:

@table @samp
@item g
Start with guile debugging evaluator and backtraces. This is convenient
for debugging user-defined filters (@pxref{Scheme Filters}).

@item T
Enable libmailutil traces (@code{MU_DEBUG_TRACE}).

@item P
Enable network protocol traces (@code{MU_DEBUG_PROT})

@item t
Enable sieve trace (@code{MU_SIEVE_DEBUG_TRACE})

@item l
Enable sieve action logs
@end table

The digits in the range @samp{0} -- @samp{9} used in @var{flags} set
@command{mail.local} debugging level.
@item -v
@itemx --version
Display program version and exit.
@item --ex-multiple-delivery-success
Don't return errors when delivering to multiple recipients.
@item --ex-quota-tempfail
Return temporary failure if disk or mailbox quota is exceeded. By
default, 'service unavailable' is returned if the message exceeds
the mailbox quota.
@end table

@node MTA
@subsection Using @command{mail.local} with Various MTAs

This section explains how to invoke @command{mail.local} from
configuration files of various Mail Transport Agents.

All examples in this section suppose that @command{mail.local}
must receive following command line switches:

@smallexample
-s %h/.filter.scm -q /etc/mail/userquota
@end smallexample

@menu
* Sendmail::    Using @command{mail.local} with Sendmail.
* Exim::        Using @command{mail.local} with Exim.
@end menu

@node Sendmail
@subsubheading Using @command{mail.local} with Sendmail

The @command{mail.local} must be invoked from the local mailer
definition in the @file{sendmail.cf} file. It must have the
following flags set @samp{lswS}, meaning the mailer is local,
the quote characters should be stripped off the address before
invoking the mailer, the user must have a valid account on this
machine and the userid should not be reset before calling the
mailer. Additionally, @samp{fn} flags may be specified to allow
@command{mail.local} to generate usual @samp{From } envelope
instead of the one supplied by sendmail.

If you wish to use mail.local with SQL authentication, you may
wish to remove the @samp{w} flag, since in that case the user is
not required to have a valid account on the machine that runs
@command{sendmail}.

Here is an example of mailer definition in @file{sendmail.cf}

@smallexample 
Mlocal, P=/usr/local/libexec/mail.local,
        F=lsDFMAw5:/|@@qSPfhn9,
        S=EnvFromL/HdrFromL, R=EnvToL/HdrToL,
        T=DNS/RFC822/X-Unix,
        A=mail $u
@end smallexample

To define local mailer in @samp{mc} source file, it will suffice to
set:

@smallexample
define(`LOCAL_MAILER_PATH', `/usr/local/libexec/mail.local')
define(`LOCAL_MAILER_ARGS', `mail $u')
@end smallexample

@node Exim
@subsubheading Using @command{mail.local} with Exim

Using @command{mail.local} with Exim is quite straightforward. The
following example illustrates the definition of appropriate transport
and director in @file{exim.conf}:

@smallexample
# transport
mail_local_pipe:
  driver = pipe
  command = /usr/local/libexec/mail.local $local_part
  return_path_add
  delivery_date_add
  envelope_to_add
  
# director
mail_local:
  driver = localuser
  transport = mail_local_pipe
@end smallexample

@node Mailbox Quotas
@subsection Setting up Mailbox Quotas

Sometimes it is necessary to limit the maximum size of a user's
mailbox. Such maximum size is called @dfn{mailbox quota} for this
user.

When delivering a message, @command{mail.local} first cheks if
the mailbox quota is specified for the recipient. If so,
@command{mail.local} computes the difference between the quota
value and the actual size of the recipient's mailbox. This difference
represents the maximum size of the message the receipient's mailbox is
able to accomodate. Let's call it @var{msize}. Depending on its value,
@command{mail.local} takes decision on whether to deliver the message.
There are three possible cases:

@enumerate 1
@item @var{msize} equals zero. This means that the mailbox size has
reached its limit). In this case the message is not delivered and
the sender receives following notification message:

@smallexample
@var{user}: mailbox quota exceeded for this recipient
@end smallexample

@item @var{msize} is less than the size of the message
@command{mail.local} is about to deliver. In this case the message is
not delivered and the sender receives following notification message:

@smallexample
@var{user}: message would exceed maximum mailbox size for this recipient
@end smallexample

@item @var{msize} is greater than or equal to the size of the
message. In this case @command{mail.local} does deliver the message.
@end enumerate

Version @value{VERSION} of @sc{gnu} mailutils is able to retrieve 
mailbox quotas from a @sc{dbm} or @sc{sql} database.

@menu
* DBM Quotas::          Keeping Quotas in DBM Database.
* SQL Quotas::          Keeping Quotas in SQL Database.
@end menu

@node DBM Quotas
@subsubsection Keeping Quotas in DBM Database

To use the @sc{dbm} quota database, your copy of @code{mailutils} must
be compiled with @sc{dbm} support (one of @option{--with-gdbm},
@option{--with-db2}, @option{--with-ndbm}, @option{--with-dbm} options
to @code{configure}). Examine the of
@command{mail.local --show-config-options} if not sure.

The  quota database should have the following structure:

@table @asis
@item Key
Key represents the user name. Special key @samp{DEFAULT} means default
quota value, i.e. the one to be used if the user is not explicitely
listed in the database.

@item Value
The mailbox quota for this user. If it is a number, it represents the
maximum mailbox size in bytes. A number may optionally be followed by
@samp{kb} or @samp{mb}, meaning kilobytes and megabytes, respectively.

A special value @samp{NONE} means no mailbox size limitation for this user.
@end table

Here is an example of a valid quota database

@smallexample
# Default quota value:
DEFAULT         5mb

# Following users have unlimited mailbox size
root            NONE
smith           NONE

# Rest of users
plog            26214400
karin           10mB
@end smallexample

To use the @sc{dbm} database, specify its full name using @option{-q}
or @samp{--quota-db} in the invocation of @command{mail.local}. For
example, in @command{sendmail} @code{.mc} file:

@smallexample
define(`LOCAL_MAILER_PATH', `/usr/local/libexec/mail.local')
define(`LOCAL_MAILER_ARGS', `mail -q /etc/mail/quota.db $u')
@end smallexample

@node SQL Quotas
@subsubsection Keeping Quotas in SQL Database

Option @option{--quota-query} allows to specify a special query to
retrieve the quota from the database. Currently (as of mailutils
version @value{VERSION}) it is assumed that this table can be accessed
using the same credentials as @sc{sql} authentication tables
(@xref{daemon}, for the detailed discussion of @option{--sql-} options).

For example, suppose you have the following quota table:

@smallexample
create table mailbox_quota (
  user_name varchar(32) binary not null,
  quota int,
  unique (user_name)
);
@end smallexample

@noindent

To retrieve the quota for user @code{%u} you may then use the
following query:

@smallexample
SELECT quota
FROM mailbox_quota
WHERE user_name='%u'
@end smallexample

There is no special provisions for specifying group quotas, similar to
@samp{DEFAULT} in @sc{dbm} databases. This is because group quotas can
easily be implemented using @sc{sql} language. @command{Mail.local}
always uses the first tuple from the set returned by mailbox quota
query. So, you may add a special entry to the @code{mailbox_quota}
table that would keep the group quota. For the following discussion,
it is important that the @code{user_name} column for this entry be
lexicographically less than any other user name in the table. Let's
suppose the group quota name is @samp{00DEFAULT}. Then the following
query:

@smallexample
SELECT quota
FROM mailbox_quota
WHERE user_name IN ('%u','00DEFAULT')
ORDER BY user_name DESC
@end smallexample

@noindent
will return two tuples if user @code{%u} is found in
@code{mailbox_quota}. Due to @code{ORDER} statement, the first tuple
will contain the quota for the user, which will be used by
@command{mail.local}. On the other hand, if user name @code{%u} is not
present in the table, the above query will return a single tuple
containing the group quota.

To summarize this, here is a working @file{mailutils.rc} entry for
@command{mail.local}:

@smallexample
:mail.local \
      --sql-db MAILAUTH \
      --sql-host some.host.net \
      --sql-user mail.local \
      --sql-passwd guessme \
      --quota-query "SELECT quota \
                     FROM mailbox_quota \
                     WHERE user_name IN ('%u','00DEFAULT') \
                     ORDER BY user_name DESC"
@end smallexample
                     

@node Sieve Filters
@subsection Implementing User-defined Sieve Mail Filters

@node Scheme Filters
@subsection Implementing User-defined Scheme Mail Filters

@page
@node mail.remote
@section @command{mail.remote} --- Pseudo-Sendmail Interface for Mail Delivery
@pindex mail.remote

[FIXME]

@page
@node mimeview
@section mimeview
@pindex mimeview

  For each file given in its command line, @command{mimeview} attempts
to autodetect its type and invoke an appropriate file viewer.

  To detect the file type, @command{mimeview} uses @file{mime.types}
file. This file is a part of Common UNIX Printing System, see
@code{man mime.types} for the description of its syntax. [FIXME:
provide an xref to CUPS]. By default @command{mimeview} searches for
@file{mime.types} in @file{$prefix/etc/cups/}@footnote{The exact
location is determined at configuration time by setting environment
variable @var{DEFAULT_CUPS_CONFDIR}. On most sites running

@smallexample
./configure DEFAULT_CUPS_CONFDIR=/etc/cups
@end smallexample

@noindent
should be recommended.}, however its exact location can be specified
at runtime as well (see @option{--mimetypes} below).

  Once file MIME type is successfully determined, @command{mimeview}
consults @file{mailcap} files in order to determine how to display
the file. It does so essentially in the same manner as
@command{metamail} utility, i.e., it scans all files specified
in @code{METAMAIL} environment variable until it finds an entry
describing the desired file format or until the list of files is
exhausted. If @code{METAMAIL} variable is not set, @command{mimeview}
uses the following default path instead:

@smallexample
$HOME/.mailcap:/usr/local/etc/mailcap:\
 /usr/etc/mailcap:/etc/mailcap:\
 /etc/mail/mailcap:/usr/public/lib/mailcap
@end smallexample

  The following table summarizes options specific for @command{mimeview}:

@table @option
@item -a[@var{type-list}]
@itemx --no-ask[=@var{type-list}]
By default @command{mimeview} asks for comnfirmation before running
interpreter to view a message. If this option is used without
argument, it disables the default behavior for all message
types. Otherwise, if argument @var{type-list} is given, it specifies
a comma-separated list of MIME types for which no questions should be
asked. Elements of this list may include shell-style globbing
patterns, e.g. setting

@smallexample
--no-ask='text/*,image/jpeg'
@end smallexample

@noindent
will disable prompting before displaying any textual files, no
matter what their subtype is, and before displaying files with
type @samp{image/jpeg}.

  Notice, that when the long form is used, its argument
must be separated from the option by a single equal sign, as shown
in the example above. When the short form (@option{-a}) is used, its argument
must follow the option immediately, without any intervening whitespace,
e.g. @option{-a'text/*'}). 

@item -d[@var{flags}]
@itemx --debug[=@var{flags}]
Enables debugging output. @var{Flags} is a sequence of characters
specifying the desired debugging level. Following characters are
meaningful in @var{flags}:

@table @asis
@item g
Enables debugging of @file{mime.types} parser

@item l
Enables debugging of @file{mime.types} lexical analyzer (warning:
produces @emph{very} copious output)

@item 1
Prints basic information about actions to be executed and reports
about exit status of executed commands.

@item 2
Additionally displays each file name along with its MIME type

@item 3
Additionally traces the process of looking up the matching entry
in @code{mailcap} files.

@item digits from 4 to 9
The same as 3, currently.
@end table

If @var{flags} are not given, the default @samp{9} is assumed.

@item --metamail[=@var{file}]
Run @command{metamail} to display files, instead of using the internal
mechanisms. If @var{file} is specified, it is taken as
@command{metamail} command line.

@item -h
@itemx --no-interactive
@itemx --print
This options tells @command{mimeview} that it should run in
non-interactive mode. In this mode prompting is disabled, and
the normal mailcap @code{command} field is not executed. Instead
@command{mimeview} will execute the command specified in
the @code{print} field. If there is nothing in the print field,
the mailcap entry is ignored and the search continues for a matching
mailcap entry that does have a @code{print} field.

Notice, that unlike in @command{metamail -h}, this option does
not force @command{mimeview} to send the output to the printer
daemon.

When used with @option{--metamail} option, this option passes
@option{-h} flag to the invocation of @command{metamail}.

By default @command{mimeview} behaves as if given
@option{--no-interactive} option whenever its standard input is not
a @asis{tty} device.

@item -n
@itemx --dry-run
Do not do anything, just print what whould be done. Implies
@option{--debug=1}, unless the debugging level is set up explicitely.

@item -t @var{file}
@itemx --mimetypes @var{file}
Use @var{file} as @file{mime.types} file. If @var{file} is a
directory, use @file{@var{file}/mime.types}
@end table


@page
@node pop3d
@section POP3 Daemon
@pindex pop3d

The @command{pop3d} daemon implements the Post Office Protocol
Version 3 server.

@command{pop3d} has two operation modes:

@table @asis
@item Inetd
The server is started from @file{/etc/inetd.conf} file:

@smallexample
pop3  stream tcp nowait  root  /usr/local/sbin/pop3d pop3d
@end smallexample

This is the default operation mode.

@item Standalone
The server runs as daemon, forking a child for each new connection. This
mode is triggered by @option{-d} command line switch.
@end table

The program uses following option groups: @xref{mailbox},
@xref{daemon}, @xref{logging}, @xref{auth}.

@menu
* Login delay::
* Auto-expire::
* Bulletins::
* Command line options::
@end menu

@node Login delay
@subsection Login delay

  POP3 clients often login frequently to check for new mail. Each new
connection implies authenticating the user and opening his maildrop
and can be very resource consuming. To reduce server load, it is
possible to impose a minimum delay between any two consecutive logins.
This is called @samp{LOGIN-DELAY} capability and is described in RFC
2449.

  As of version @value{VERSION}, GNU Mailutils @command{pop3d} allows
to set global login delay, i.e. such enforcement will affect all POP3
users. If a user attempts to log in before the specified login delay
expires, he will get the following error message:

@smallexample
-ERR [LOGIN-DELAY] Attempt to log in within the minimum login delay interval
@end smallexample

The message will be issued after a valid password is entered. This prevents
this feature from being used by malicious clients for account
harvesting.

  To enable the login delay capability, specify the minimum delay in
seconds with @option{--login-delay} option, for example:

@smallexample
$ pop3d --login-delay=60
@end smallexample

  The @command{pop3d} utility keeps each user's last login time in a
special DBM file, called @dfn{login statistics database}, so to be
able to use this feature, Mailutils must be compiled with DBM support.
By default, the login statistics database is called
@file{/var/run/pop3-login.db}. You can change its name at run time
using @option{--stat-file}:

@smallexample
$ pop3d --login-delay=60 --stat-file=/tmp/pop.login
@end smallexample

  Notice, that there is no need to include the @samp{.db} suffix in the
file name.

  The login delay facility will be enabled only if @command{pop3d} is
able to access the statistics database for both reading and
writing. If it is not, it will report this using @command{syslog} and
start up without login delay restrictions. The common error message
looks like:

@smallexample
Unable to open statistics db: Operation not permitted
@end smallexample

  You can check whether your @command{pop3d} uses login delays by
connecting to it and issuing the @samp{CAPA} command. If login delays
are in use, there response will contain the string @samp{LOGIN-DELAY
@var{n}}, where @var{n} is the actual login delay value.

@node Auto-expire
@subsection Auto-expire

  Automatic expiration of messages allows you to limit the period of
time users are permitted to keep their messages on the server. It is
enabled by @option{--expire} command line option:

@smallexample
$ pop3d --expire=@var{days}
@end smallexample

@noindent
Here, @var{days} specifies the minimum server retention period, in
days, for retrieved messages on the server.

  Current implementation works as follows. When a message is
downloaded by @code{RETR} or @code{TOP} command, it is marked with
@samp{X-Expire-Timestamp: @var{n}} header, where @var{n} is current
value of UNIX timestamp. The exact expiration mechanism 
depends on you.  Mailutils allows you two options:

@enumerate
@item
Expired messages are deleted by @command{pop3d} upon closing the
mailbox. You specify this mechanism using @option{--delete-expired}
command line option.

@item
Expired messages remain in the mailbox after closing it. The system
administrator is supposed to run a cron job that purges the mailboxes.
Such a cron job can be easily implemented using @command{sieve} from
GNU Mailutils and the following script:

@smallexample
@group
require "timestamp";
# @r{Replace "5" with the desired expiration period}
if timestamp :before "X-Expire-Timestamp" "now - 5 days"
  @{
    discard;
  @}
@end group
@end smallexample

This script will remove expired messages 5 days after the
retrieval. Replace @samp{5} with the desired expiration period and
make sure it equals the argument to @option{--expire} command.
@end enumerate

The option @option{--expire=0} means the client is not permitted to
leave mail on the server. It always implies @option{--delete-expired}. 

@node Bulletins
@subsection Bulletins

  The bulletin feature allows you to send important announcements to
all POP3 users without mailing them. It works by creating a
@dfn{bulletin source mailbox} and sending the announcements to it.

  After a user successfully authenticates, @command{pop3d} checks the
last @dfn{bulletin number} the user receives. The bulletin number
refers to the number of the bulletin message in the bulletin source
mailbox. If the latter contains more messages, these are appended to
the user mailbox.

  The user last bulletin number can be kept in two places. First, it
can be stored in file @file{.popbull} in his home directory. Secondly,
if Mailutils is compiled with DBM support, the numbers can be kept in
a DBM file, supplied via @option{--bulletin-db} command line option. If
both the database and the @file{.popbull} file are present, the data
from the database take precedence.

  To enable this feature, use the following command line options:

@table @option
@item --bulletin-source=@var{mbox}
Set the @acronym{URL} of the bulletin source mailbox.

@item --bulletin-db=@var{file}
Set the name of the database file to keep last bulletin numbers in.
Be sure not to specify @samp{.db} extension.
@end table

  The following example instructs @command{pop3d} to look for the
bulletin messages in @acronym{MH} folder @file{/var/spool/bull/mbox}
and to keep the database of last delivered bulletin numbers in
@file{/var/spool/bull/numbers.db}:

@smallexample
@group
$ pop3d --bulletin-source=mh:/var/spool/bull/mbox \
        --bulletin-db=/var/spool/bull/numbers
@end group
@end smallexample
        
@node Command line options
@subsection Command line options

The following table summarizes all @command{pop3d} command line options.

@table @option
@item --bulletin-db=@var{file}
Set the name of the database file to keep last bulletin numbers in.
Be sure not to specify @samp{.db} extension. @xref{Bulletins}.

@item --bulletin-source=@var{mbox}
Set the @acronym{URL} of the bulletin source mailbox. @xref{Bulletins}.

@item -d[@var{number}]
@itemx --daemon[=@var{number}]
Run in standalone mode. An optional @var{number} specifies the maximum number
of child processes allowed to run simultaneously. When it is omitted,
it defaults to 10 processes.
@emph{Please note}, that there should be no whitespace between the
@option{-d} and its parameter.

@item --delete-expired
Delete expired messages upon closing the mailbox. @xref{Auto-expire}.

@item --expire=@var{days}
Expire read messages after the given number of days. If @var{days} is
0, this option implies @option{--delete-expired}. @xref{Auto-expire}.

@item -i
@itemx --inetd
Run in inetd mode.

@item -h
@itemx --help
Display short help message and exit.

@item --login-delay=@var{seconds}
Sets the minimum allowed delay between closing a pop3d session and
opening it again with the same user name. @xref{Login delay}.

@item -m @var{path}
@itemx --mail-spool=@var{path}
Set path to the mailspool directory

@item -p @var{number}
@itemx --port @var{number}
Listen on given port @var{number}. This option is meaningful only in
standalone mode. It defaults to port 110.

@item --stat-file=@var{filename}
Sets the name of the login timestamp database, used with
@option{--login-delay}. By default, these data are kept in
@file{/var/run/pop3-login}. Be sure to specify the file name
@emph{without} DBM-specific suffix. @xref{Login delay}.

@item -t @var{number}
@itemx --timeout @var{number}
Set idle timeout to given @var{number} of seconds. Default is 600 seconds (10
minutes).  The daemon breaks the connection if it receives no commands
from the client within that number of seconds.

@item --tls-required
Always require @code{STLS} command before entering authentication phase.

@item -v
@itemx --version
Display program version and exit.

@item --undelete
Remove all deletion marks from the messages after opening the mailbox.

@end table

@page
@node imap4d
@section IMAP4 Daemon
@pindex imap4d

@sc{gnu} @command{imap4d} is a daemon implementing @sc{imap4} rev1 protocol
for accessing and handling electronic mail messages on a server. It can
be run either as a standalone program or from @file{inetd.conf} file.

@menu
* Namespace::       Namespace.
* Starting imap4d:: Invocation Options.
@end menu

@node Namespace
@subsection Namespace
@cindex namespace
@cindex IMAP4 namespace

@sc{gnu} @command{imap4d} supports a notion of @dfn{namespaces} defined
in RFC 2342. A namespace is a set of directories upon which the user
has certain permissions. It should be understood that these permissions
apply only if the underlying filesystem allows them.

The three namespaces supported by @command{imap4d} are:

@table @asis
@item Personal Namespace
A namespace that is within the personal scope of the authenticated user
on a particular connection. The user has all permissions on this namespace.

@item Other Users' Namespace
A namespace that consists of mailboxes from the ``Personal Namespaces''
of other users. The user can read and list mailboxes from this
namespace. However, he is not allowed to use @samp{%} and @samp{*}
wildcards with @command{LIST} command, that is he can access a
mailbox only if he knows exactly its location.

@item Shared Namespace
A namespace that consists of mailboxes that are intended to be shared
amongst users and do not exist within a user's Personal Namespace.
The user has all permissions on this namespace.
@end table

@noindent
By default, @command{imap4d} starts with the following namespaces:

@table @asis
@item Personal Namespace
The home directory of the user, if exists.

@item Other Users' Namespace
Empty

@item Shared Namespace
Empty
@end table

@emph{Note}, that this means that by default, a user won't be able to
see or otherwise access mailboxes residing in the directories other than
his own home.

To change these defaults, use @option{--shared-namespace} and
@option{--other-namespace} options.

@node Starting imap4d
@subsection Starting @command{imap4d}

@command{imap4d} may run either in @dfn{standalone} or in @dfn{inetd}
operation modes. When run in ``standalone'' mode, the server disconnects
from the terminal and runs as a daemon, forking a child for each new
connection.

The ``inetd'' mode allows to start the server from
@file{/etc/inetd.conf} file. This is the default operation mode. 

@smallexample
imap4  stream tcp nowait  root  /usr/local/sbin/imap4d imap4d
@end smallexample

The program uses following option groups: @xref{mailbox},
@xref{daemon}, @xref{logging}, @xref{auth}.

@subheading Command Line Options

@table @option
@item --create-home-dir[=@var{mode}]
If a user logs in and his home directory does not exist, create
it. Optional @var{mode} is an octal number specifying the permissions
to be set on the created directory. It is not modified by the current
@code{umask} value. The default value for @var{mode} is @samp{700}
(@samp{drwx------} in @code{ls} terms). 
@item -d[@var{number}]
@itemx --daemon[=@var{number}]
Run in standalone mode. An optional @var{number} specifies the maximum number
of child processes the daemon is allowed to fork. When it is omitted,
it defaults to 20 processes.
@emph{Please note}, that there should be no whitespace between the
@option{-d} and its parameter.
@item -h
@itemx --help
Display short help message and exit.
@item -i
@itemx --inetd
Run in inetd mode.
@item -m @var{path}
@itemx --mail-spool=@var{path}
Set path to the mailspool directory
@item -O @var{pathlist}
@itemx --other-namespace=@var{pathlist}
Set the list of directories forming the ``Other User's'' namespace.
@var{pathlist} is a list of directory names separated by colons.
@item -p @var{number}
@itemx --port @var{number}
Listen on given port @var{number}. This option is meaningful only in
standalone mode. It defaults to port 143.
@item -S @var{pathlist}
@itemx --shared-namespace=@var{pathlist}
Set the list of directories, forming the ``Shared''
namespace. @var{pathlist} is a list of directory names separated by colons.
@item -t @var{number}
@itemx --timeout @var{number}
Set idle timeout to given @var{number} of seconds. Default is 1800 seconds (30
minutes).  The daemon breaks the connection if it receives no commands
from the client within that number of seconds.
@item -v
@itemx --version
Display program version and exit.
@end table

@page
@node comsatd
@section Comsat Daemon
@pindex comsatd

Comsatd is the server which receives reports of incoming mail and
notifies users, wishing to get this service. It can be started
either from @file{inetd.conf} or as a standalone daemon.

@menu
* Starting comsatd::       Invocation.
* Configuring comsatd::    Configuration of @command{comsatd}.
* dot.biffrc::             A per-user configuration file.
@end menu

@node Starting comsatd
@subsection Starting @command{comsatd}

@command{Comsatd} uses following option groups: @xref{mailbox},
@xref{daemon}, @xref{logging}.

@table @option
@item -c @var{file}
@itemx --config @var{file}
Read configuration from given @var{file}. For more information about
comsatd configuration files, see @ref{Configuring comsatd}.
@item -d
@itemx --daemon
Run as a standalone daemon.
@item -i
@itemx --inetd
The server is started from @file{/etc/inetd.conf} file:

@smallexample
comsat dgram  udp wait  root  /usr/sbin/comsatd \
comsatd -c /etc/comsat.conf
@end smallexample

This is the default operation mode.
@item -m @var{path}
@itemx --mail-spool=@var{path}
Set path to the mailspool directory
@item -p @var{number}
@itemx --port @var{number}
Specify the port number to listen on. Default is 512.
@item -v
@itemx --version
Output version and exit successfully.
@item -h
@itemx --help
Display short help message and exit.
@end table

@node Configuring comsatd
@subsection Configuring @command{comsatd}

The configuration parameters for @command{comsatd} are kept in a single
configuration file. The file uses line-oriented format: each line
contains a single statement. Comments are introduced with the @samp{#}
sign and empty lines are ignored. You can specify the configuration
file to use by using @option{-c} or @option{--config} command line switch.

The configuration file statements can logically be subdivided into
@dfn{General Settings}, @dfn{Security Settings} and @dfn{Access Control
Lists}. The following sections address each of these statement group in
detail.

@menu
* General Settings::
* Security Settings::
* Access Control Lists::
@end menu

@node General Settings
@subsubheading General Settings

These statements control the general behavior of the comsat daemon:

@table @asis
@item max-lines @var{number}
Set maximum number of message body lines to be output.
@item allow-biffrc ( yes | no )
Enable or disable processing of user's @file{.biffrc} file. By default,
it is enabled.
@end table

@node Security Settings
@subsubheading Security Settings

These statements control the way @command{comsatd} fights possible
flooding attacks.

@table @asis
@item max-requests @var{number}
Set maximum number of incoming requests per @samp{request-control-interval}.
@item request-control-interval @var{number}
Set the request control interval (seconds).
@item overflow-delay-time @var{number}
Set the initial amount of time to sleep, after the first overflow occurs.
@item overflow-control-interval @var{number}
Set the overflow control interval. If two consecutive overflows happen
within @var{number} seconds, the overflow-delay-time is doubled.
@end table

@node Access Control Lists
@subsubheading Access Control Lists

Access control lists determine from which addresses @command{comsatd}
will receive mail notification messages.

The access control lists are introduced in configuration file using
keyword @samp{acl}. General format for an ACL rule is

@smallexample
acl @var{action} @var{netlist}
@end smallexample

@noindent
Here, @var{action} specifies the action to be taken when a request
arrives from one of the networks, listed in @var{netlist}. There are
two possible actions: @samp{allow} and @samp{deny}.

The @var{netlist} is a whitespace-separated list of network numbers.
Each network number may be specified in one of the following forms:

@table @asis
@item @var{netnum}
Means a single host with IP address @var{netnum}.
@item @var{netnum}/@var{netmask}
@item @var{netnum}/@var{masklen}
@item @samp{any}
Denotes any IP address. It is equivalent to @samp{0.0.0.0/0}.
@end table

Upon receiving a notification message, @command{comsatd} compares its
source address against each ACL rule in the order of their appearance
in the configuration file. The first rule that matches the packet
determines whether the message will be processed or rejected. If
no matching rule was found, the default rule applies. Currently, default
rule is

@smallexample
acl allow any
@end smallexample

@noindent
If you don't need such behavior, specify the default rule explicitly.
For example, the common use would be:

@smallexample
@group
acl allow 127.0.0.1
acl deny any
@end group
@end smallexample

@noindent
which makes @command{comsatd} receive the notification messages from
localhost only.

@node dot.biffrc
@subheading A per-user Configuration File

By default, when a notification arrives, @command{comsatd} prints subject,
from headers and the first five lines from the new message to the user's
tty. The user is allowed to change this behavior by using his own
configuration file. This file should be located in the user's home
directory and should be named @file{.biffrc}. It must be owned by the
user and have its permissions bits set to 0600. (@emph{Please note},
that the use of per-user configuration files may be disabled, by
specifying @samp{allow-biffrc no} in the main configuration file, see
@pxref{Configuring comsatd}).

The @file{.biffrc} file consists of a series of statements. Each
statement occupies one line and defines an action to be taken upon
arrival of a new mail. Very long lines may be split using @samp{\} as
the last character on the line. As usual, comments may be introduced with
@samp{#} character.

The actions specified in @file{.biffrc} file are executed in turn.
The following actions are defined:

@table @asis
@item beep
Produce an audible signal.
@item echo [-n] @var{string} [@var{string}...]
Output the arguments to the user's terminal device. If several
arguments are given they will be output separated by single
spaces. The newline character will be printed at the end of the
output, unless the @option{-n} option is used.
@item exec @var{prog} @var{arglist}
Execute program @var{prog} with arguments from @var{arglist}. @var{prog}
must be specified with absolute pathname. It may not be a setuid or
setgid program.
@end table

In the description above, @var{string} denotes any sequence of
characters. This sequence must be enclosed in a pair of double-quotes,
if it contains whitespace characters. The @samp{\} character inside a
string starts a C escape sequence. Following meta-characters may be
used in strings:

@table @asis
@item $u
Expands to username
@item $h
Expands to hostname
@item $H@{name@}
Expands to value of message header @samp{name}.
@item $B(@var{c},@var{l})
Expands to message body. @var{c} and @var{l} give maximum number of
characters and lines in the expansion. When omitted, they default to 400, 5.
@end table

@subheading Example I

Dump to the user's terminal the contents of @samp{From} and
@samp{Subject} headers followed by at most 5 lines of message body.
@smallexample
@group
echo "Mail to \a$u@@$h\a\n---\n\
From: $H@{from@}\n\
Subject: $H@{Subject@}\n\
---\n\
$B(,5)\
---\n"
@end group
@end smallexample

@noindent
The above example can also be written as:
@smallexample
@group
echo Mail to \a$u@@$h\a
echo ---
echo From: $H@{From@}
echo Subject: $H@{Subject@}
echo ---
echo $B(,5)
echo ---
@end group
@end smallexample

@subsubheading Example II

Produce a bell, then pop up the xmessage window on display :0.0 with
the text formatted in the same manner as in the previous example.

@smallexample
@group
beep
exec /usr/X11R6/bin/xmessage \
-display :0.0 -timeout 10 "Mail to $u@@$h \n---\n\
From: $H@{from@}\n\
Subject: $H@{Subject@}\n\
---\n\
$B(,5)\
---\n"
@end group
@end smallexample

@page
@node mh
@section @acronym{MH} --- The MH Message Handling System

@include mu-mh.texi

@page
@node mailutils-config
@section @command{mailutils-config} --- Get the Information about the Mailutils Build
@pindex mailutils-config

This program is designed for developers wishing to link their programs
against libmailbox. It allows to examine the particulars of the
current build of Mailutils and to get the command line parameters
necessary for compiling and linking an application with Mailutils
libraries.

@menu
* Compiler Flags::      Getting Compiler Flags.
* Loader Flags::        Getting Loader Flags.
* General Information:: Obtaining General Build Information.
@end menu

@node Compiler Flags
@subheading Getting Compiler Flags

When invoked with the option @option{--compile}, or its short form
@option{-c}, @command{mailutils-config} prints the flags
that must be given to the compiler for compiling the program using
Mailutils functions. An example usage:

@smallexample
cc -omyprog.o `mailutils-config --compile` myprog.c
@end smallexample               

@node Loader Flags
@subheading Getting Loader Flags

The @option{--link}, or its short form @option{-l} prints to the
standard output the loader flags necessary to link a program against
Mailutils libraries.

When invoked without arguments, it produces the flags necessary to
link against the basic library of Mailutils: @file{libmailbox}.
Arguments may be given that alter this behavior. These are:

@table @samp

@item auth
Print flags to link against @file{libmuauth}, the library adding new
authentication methods to @file{libmailbox}.

@item guile
Print flags to link against @file{libmu_scm}, the Guile interface
library.

@item mbox
Link against @code{mbox} format library.

@item mh
Link against @code{mh} format library.

@item maildir
Link against @code{maildir} format library.

@item mailer
Link against @code{mailer} library.

@item imap
Link against @code{imap} format library.

@item pop
Link against @code{pop} format library.

@item all
Link against all Mailutils format libraries.
@end table

The order of arguments does not matter.

For example, if you wrote a program @file{myprog.c} that uses
standard @sc{unix} mailbox format, @sc{mh} format and the
Guile interface, then you would link it with the following
command:

@smallexample
cc -omyprog myprog.o `mailutils-config --link mbox mh guile`
@end smallexample

@node General Information
@subheading Obtaining General Build Information

The @option{--info}, or @option{-i} retrieves the options (flags) used
when building Mailutils. It may be used with or without
arguments.

When used without arguments, it prints the list of all
build flags, e.g.:

@smallexample
$ mailutils-config --info
VERSION=0.4.1
USE_LIBPAM
HAVE_LIBLTDL
WITH_GDBM
WITH_GNUTLS
WITH_GSASL
WITH_GUILE
WITH_PTHREAD
WITH_READLINE
HAVE_MYSQL
ENABLE_VIRTUAL_DOMAINS
ENABLE_IMAP
ENABLE_POP
ENABLE_MH
ENABLE_MAILDIR
ENABLE_SMTP
ENABLE_SENDMAIL
@end smallexample

This option also accepts any number of arguments. When these are
given, each argument is treated as a name of a build flag. 
@command{Mailutils-config} checks if such a flag was defined and
prints its full name if so. It exits with zero code if all the
flags given on the command line are defined. Otherwise, it
exits with code of 1.

The comparison of the flag names is case-insensitive. The arguments
given need not include the leading prefix (i.e. the characters up
to and including the first underscore character).

Given the previous example, the invocation

@smallexample
$ mailutils --info readline use_libpam pop
@end smallexample

@noindent
will produce the following output:

@smallexample
WITH_READLINE
USE_LIBPAM
ENABLE_POP
@end smallexample

@noindent
and will exit with a zero status.

The following command:

@smallexample
$ mailutils --info readline gssapi pop
@end smallexample

@noindent
will exit with status 1, and will print:

@smallexample
WITH_READLINE
ENABLE_POP
@end smallexample

@noindent
since @code{WITH_GSSAPI} flag is not defined.

The flags and their meanings are:

@table @asis
@c @item VERSION=" VERSION,
@item USE_LIBPAM
The Mailutils uses @sc{pam} libraries.

@item HAVE_LIBLTDL
The @sc{gnu} wrapper library @file{libltdl} is present and is used
by Mailutils. @xref{Using libltdl,,,libtool,Using libltdl}, for
more information on @file{libltdl} library.

@item WITH_BDB2
Support for Berkeley DB is compiled in (the package was configured with
@option{--with-db2} option).

@item WITH_NDBM
Support for NDBM is compiled in (the package was configured with
@option{--with-ndbm} option).

@item WITH_OLD_DBM
Support for old style DBM is compiled in (the package was configured with
@option{--with-dbm} option).

@item WITH_GDBM
Support for GNU DBM is compiled in (the package was configured with
@option{--with-gdbm} option). @xref{Top,,Introduction,gdbm,The GNU DBM Manual},
for more information about this library.

@item WITH_GNUTLS
Support for GnuTLS (a Transport Layer Security Library) is compiled in
(the package was configured with @option{--with-gnutls} option).

@item WITH_GSASL
Support for GNU SASL is compiled in (the package was configured with
@option{--with-gsasl} option). @xref{Top,,Introduction,gsasl,The GNU SASL Manual},
for more information about this library.

@item WITH_GSSAPI
Support for @sc{gssapi} is compiled in (the package was configured with
@option{--with-gssapi} option).

@item WITH_GUILE
Support for Guile extension language is built (the package was
configured with @option{--with-guile} option).
@xref{Top,,Overview,guile,The Guile Reference Manual},
for more information about Guile.

@item WITH_PTHREAD
The @sc{posix} thread support is compiled in.

@item WITH_READLINE
The readline support is enabled (the package was
configured with @option{--with-readline} option).
@xref{Top,,,readline,The GNU Readline Library}, for more information.

@item HAVE_MYSQL
Authentication via MySQL is supported (the package was
configured with @option{--enable-mysql} option).

@item ENABLE_VIRTUAL_DOMAINS
Support for mail virtual domains is enabled (the package was
configured with @option{--enable-virtual-domains} option).

@item ENABLE_IMAP
Support for @sc{imap4} protocol is enabled.

@item ENABLE_POP
Support for @sc{pop3} protocol is enabled.

@item ENABLE_MH
Support for mailboxes in @sc{mh} format is enabled.

@item ENABLE_MAILDIR
Support for mailboxes in @sc{Maildir} format is enabled.

@item ENABLE_SMTP
Support for @sc{smtp} mailer is enabled.

@item ENABLE_SENDMAIL
Support for Sendmail mailer is enabled.
@end table
